<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html"><meta property="og:site_name" content="huluhutublog"><meta property="og:title" content="索引"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-10-06T10:31:37.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2022-10-06T10:31:37.000Z"><link rel="icon" href="/huluhutublog/favicon.ico"><link rel="icon" href="/huluhutublog/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/huluhutublog/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/huluhutublog/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/huluhutublog/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/huluhutublog/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/huluhutublog/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/huluhutublog/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>索引 | huluhutublog</title><meta name="description" content="That is my Blog!!!">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/huluhutublog/assets/style.dc69c01e.css">
    <link rel="modulepreload" href="/huluhutublog/assets/app.0662e65c.js"><link rel="modulepreload" href="/huluhutublog/assets/7-索引.html.c1a26d4c.js"><link rel="modulepreload" href="/huluhutublog/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/huluhutublog/assets/7-索引.html.cb22779b.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/huluhutublog/" class="brand"><img class="logo" src="/huluhutublog/logo.svg" alt="huluhutublog"><!----><span class="site-name hide-in-pad">huluhutublog</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/huluhutublog/" class="nav-link" aria-label="HULUHUTU"><span class="icon iconfont icon-home"></span>HULUHUTU<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="面试"><span class="title"><span class="icon iconfont icon-note"></span>面试</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Interviews/Java/" class="nav-link" aria-label="Java"><!---->Java<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="计算机基础"><span class="title"><span class="icon iconfont icon-note"></span>计算机基础</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/DataStructuresAndAlgorithms/" class="nav-link" aria-label="数据结构与算法"><!---->数据结构与算法<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/ComputerNetwork/" class="nav-link" aria-label="计算机网络"><!---->计算机网络<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/OperatingSystem/" class="nav-link" aria-label="操作系统"><!---->操作系统<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/PrinciplesOfComputerOrganization/" class="nav-link" aria-label="计算机组成原理"><!---->计算机组成原理<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/PrinciplesOfDatabase/" class="nav-link" aria-label="数据库原理"><!---->数据库原理<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/DesignPatterns/" class="nav-link" aria-label="设计模式"><!---->设计模式<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title"><span class="icon iconfont icon-note"></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Java/JavaBase/" class="nav-link" aria-label="Java基础"><!---->Java基础<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Java/JavaIO/" class="nav-link" aria-label="JavaIO"><!---->JavaIO<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Java/JavaCollection/" class="nav-link" aria-label="Java集合"><!---->Java集合<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Java/JavaConcurrent/" class="nav-link" aria-label="Java并发编程"><!---->Java并发编程<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Java/JVM/JVM.html" class="nav-link" aria-label="JVM"><!---->JVM<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title"><span class="icon iconfont icon-note"></span>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/DB/MySQL/" class="nav-link active" aria-label="MySQL"><!---->MySQL<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/DB/Redis/" class="nav-link" aria-label="Redis"><!---->Redis<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring"><span class="title"><span class="icon iconfont icon-note"></span>Spring</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Spring/Spring/" class="nav-link" aria-label="Spring"><!---->Spring<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Spring/SpringMVC/" class="nav-link" aria-label="SpringMVC"><!---->SpringMVC<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Spring/SpringBoot/" class="nav-link" aria-label="SpringBoot"><!---->SpringBoot<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Spring/SpringCloud/" class="nav-link" aria-label="SpringCloud"><!---->SpringCloud<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="消息队列"><span class="title"><span class="icon iconfont icon-note"></span>消息队列</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/MQ/RabbitMQ/" class="nav-link" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/MQ/RocketMQ/" class="nav-link" aria-label="RocketMQ"><!---->RocketMQ<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/MQ/Kafka/" class="nav-link" aria-label="Kafka"><!---->Kafka<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="分布式"><span class="title"><span class="icon iconfont icon-note"></span>分布式</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Distributed/Artritecture/" class="nav-link" aria-label="架构"><!---->架构<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Distributed/Distributed/" class="nav-link" aria-label="分布式理论"><!---->分布式理论<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="开发工具"><span class="title"><span class="icon iconfont icon-note"></span>开发工具</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/DevelopmentTools/Git/" class="nav-link" aria-label="Git"><!---->Git<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/DevelopmentTools/Linux/" class="nav-link" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/DevelopmentTools/Docker/" class="nav-link" aria-label="Docker"><!---->Docker<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/DevelopmentTools/Maven/" class="nav-link" aria-label="Maven"><!---->Maven<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="项目"><span class="title"><span class="icon iconfont icon-note"></span>项目</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Project/SwiftHome/" class="nav-link" aria-label="快捷到家"><!---->快捷到家<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="部署"><span class="title"><span class="icon iconfont icon-note"></span>部署</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Deploy/Blog/" class="nav-link" aria-label="vuepress"><!---->vuepress<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-note"></span><span class="title">MySQL</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/" class="nav-link sidebar-link sidebar-page" aria-label="概览"><!---->概览<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/1-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="数据类型"><!---->数据类型<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/2-%E7%AE%A1%E7%90%86%E5%91%98%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" class="nav-link sidebar-link sidebar-page" aria-label="管理员常用命令"><!---->管理员常用命令<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/3-DDL.html" class="nav-link sidebar-link sidebar-page" aria-label="DDL"><!---->DDL<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/4-DML.html" class="nav-link sidebar-link sidebar-page" aria-label="DML"><!---->DML<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/5-DQL.html" class="nav-link sidebar-link sidebar-page" aria-label="DQL"><!---->DQL<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/6-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.html" class="nav-link sidebar-link sidebar-page" aria-label="存储引擎"><!---->存储引擎<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="索引"><!---->索引<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_1-什么是索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1-什么是索引？"><!---->1-什么是索引？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_2-磁盘数据存取" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2-磁盘数据存取"><!---->2-磁盘数据存取<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#mysql中的页" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="mysql中的页"><!---->mysql中的页<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#数据检索过程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="数据检索过程"><!---->数据检索过程<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_3-索引分类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3-索引分类"><!---->3-索引分类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_4-为什么使用b-树" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4-为什么使用B+树"><!---->4-为什么使用B+树<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_1-我们需要的数据结构有什么特点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.我们需要的数据结构有什么特点？"><!---->1.我们需要的数据结构有什么特点？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_2-循环遍历" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.循环遍历"><!---->2.循环遍历<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_3-二分查找" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.二分查找"><!---->3.二分查找<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_4-有序数组" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.有序数组"><!---->4.有序数组<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_5-链表" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.链表"><!---->5.链表<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#单链表" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="单链表"><!---->单链表<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#双向链表" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="双向链表"><!---->双向链表<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#链表的优点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="链表的优点："><!---->链表的优点：<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#链表的缺点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="链表的缺点："><!---->链表的缺点：<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_6-二叉查找树" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.二叉查找树"><!---->6.二叉查找树<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_7-avl树" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.AVL树"><!---->7.AVL树<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_8-b-树" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.B-树"><!---->8.B-树<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_9-b-树" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.B+树"><!---->9.B+树<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_5-存储引擎的索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5-存储引擎的索引"><!---->5-存储引擎的索引<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#mysql的存储引擎和索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Mysql的存储引擎和索引"><!---->Mysql的存储引擎和索引<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#页结构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="页结构"><!---->页结构<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_6-管理索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6-管理索引"><!---->6-管理索引<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_1-创建索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.创建索引"><!---->1.创建索引<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_2-删除索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.删除索引"><!---->2.删除索引<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_3-查看索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.查看索引"><!---->3.查看索引<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_4-索引修改" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.索引修改"><!---->4.索引修改<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_5-案例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.案例"><!---->5.案例<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_7-如何正确使用索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7-如何正确使用索引"><!---->7-如何正确使用索引<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_1-b-树的数据检索过程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.B+树的数据检索过程"><!---->1.B+树的数据检索过程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_2-索引区分度" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.索引区分度"><!---->2.索引区分度<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_3-正确使用索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.正确使用索引"><!---->3.正确使用索引<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_4-总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.总结"><!---->4.总结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/8-%E9%94%81.html" class="nav-link sidebar-link sidebar-page" aria-label="锁"><!---->锁<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/9-%E4%BA%8B%E5%8A%A1.html" class="nav-link sidebar-link sidebar-page" aria-label="事务"><!---->事务<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/10-%E8%A7%86%E5%9B%BE.html" class="nav-link sidebar-link sidebar-page" aria-label="视图"><!---->视图<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/11-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="存储过程"><!---->存储过程<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/12-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5.html" class="nav-link sidebar-link sidebar-page" aria-label="流程控制语句"><!---->流程控制语句<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/13-%E6%B8%B8%E6%A0%87.html" class="nav-link sidebar-link sidebar-page" aria-label="游标"><!---->游标<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/14-%E5%BC%82%E5%B8%B8.html" class="nav-link sidebar-link sidebar-page" aria-label="异常"><!---->异常<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/DB/MySQL/15-SQL%E4%BC%98%E5%8C%96.html" class="nav-link sidebar-link sidebar-page" aria-label="SQL优化"><!---->SQL优化<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-note"></span><span class="title">Redis</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->索引</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://mrhope.site" target="_blank" rel="noopener noreferrer">huluhutu</a></span><span property="author" content="huluhutu"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年10月6日</span><meta property="datePublished" content="2022-10-06T10:31:37.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 45 分钟</span><meta property="timeRequired" content="PT45M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_1-什么是索引" class="router-link-active router-link-exact-active toc-link level2">1-什么是索引？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_2-磁盘数据存取" class="router-link-active router-link-exact-active toc-link level2">2-磁盘数据存取</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#mysql中的页" class="router-link-active router-link-exact-active toc-link level3">mysql中的页</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#数据检索过程" class="router-link-active router-link-exact-active toc-link level3">数据检索过程</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_3-索引分类" class="router-link-active router-link-exact-active toc-link level2">3-索引分类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_4-为什么使用b-树" class="router-link-active router-link-exact-active toc-link level2">4-为什么使用B+树</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_1-我们需要的数据结构有什么特点" class="router-link-active router-link-exact-active toc-link level3">1.我们需要的数据结构有什么特点？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_2-循环遍历" class="router-link-active router-link-exact-active toc-link level3">2.循环遍历</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_3-二分查找" class="router-link-active router-link-exact-active toc-link level3">3.二分查找</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_4-有序数组" class="router-link-active router-link-exact-active toc-link level3">4.有序数组</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_5-链表" class="router-link-active router-link-exact-active toc-link level3">5.链表</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#单链表" class="router-link-active router-link-exact-active toc-link level3">单链表</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#双向链表" class="router-link-active router-link-exact-active toc-link level3">双向链表</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#链表的优点" class="router-link-active router-link-exact-active toc-link level3">链表的优点：</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#链表的缺点" class="router-link-active router-link-exact-active toc-link level3">链表的缺点：</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_6-二叉查找树" class="router-link-active router-link-exact-active toc-link level3">6.二叉查找树</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_7-avl树" class="router-link-active router-link-exact-active toc-link level3">7.AVL树</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_8-b-树" class="router-link-active router-link-exact-active toc-link level3">8.B-树</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_9-b-树" class="router-link-active router-link-exact-active toc-link level3">9.B+树</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_5-存储引擎的索引" class="router-link-active router-link-exact-active toc-link level2">5-存储引擎的索引</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#mysql的存储引擎和索引" class="router-link-active router-link-exact-active toc-link level3">Mysql的存储引擎和索引</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#页结构" class="router-link-active router-link-exact-active toc-link level3">页结构</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_6-管理索引" class="router-link-active router-link-exact-active toc-link level2">6-管理索引</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_1-创建索引" class="router-link-active router-link-exact-active toc-link level3">1.创建索引</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_2-删除索引" class="router-link-active router-link-exact-active toc-link level3">2.删除索引</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_3-查看索引" class="router-link-active router-link-exact-active toc-link level3">3.查看索引</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_4-索引修改" class="router-link-active router-link-exact-active toc-link level3">4.索引修改</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_5-案例" class="router-link-active router-link-exact-active toc-link level3">5.案例</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_7-如何正确使用索引" class="router-link-active router-link-exact-active toc-link level2">7-如何正确使用索引</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_1-b-树的数据检索过程" class="router-link-active router-link-exact-active toc-link level3">1.B+树的数据检索过程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_2-索引区分度" class="router-link-active router-link-exact-active toc-link level3">2.索引区分度</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_3-正确使用索引" class="router-link-active router-link-exact-active toc-link level3">3.正确使用索引</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/DB/MySQL/7-%E7%B4%A2%E5%BC%95.html#_4-总结" class="router-link-active router-link-exact-active toc-link level3">4.总结</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="索引" tabindex="-1"><a class="header-anchor" href="#索引" aria-hidden="true">#</a> 索引</h1><h2 id="_1-什么是索引" tabindex="-1"><a class="header-anchor" href="#_1-什么是索引" aria-hidden="true">#</a> 1-什么是索引？</h2><p>索引是依靠某些数据结构和算法来组织数据，最终引导用户快速检索出所需要的数据。</p><p>索引有2个特点：</p><ol><li>通过数据结构和算法来对原始的数据进行一些有效的组织</li><li>通过这些有效的组织，可以引导使用者对原始数据进行快速检索</li></ol><p>索引的本质：<strong>通过不断地缩小想要获取数据的范围来筛选出最终想要的结果，同时把随机的事件变成顺序的事件，也就是说，有了这种索引机制，我们可以总是用同一种查找方式来锁定数据。</strong></p><h2 id="_2-磁盘数据存取" tabindex="-1"><a class="header-anchor" href="#_2-磁盘数据存取" aria-hidden="true">#</a> 2-磁盘数据存取</h2><p>以机械硬盘来说，先了解几个概念。</p><p><strong>扇区</strong>：磁盘存储的最小单位，扇区一般大小为512Byte。</p><p><strong>磁盘块</strong>：文件系统与磁盘交互的的最小单位（计算机系统读写磁盘的最小单位），一个磁盘块由连续几个（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>）扇区组成，块一般大小一般为4KB。</p><p><strong>磁盘读取数据</strong>：磁盘读取数据靠的是机械运动，每次读取数据花费的时间可以分为<strong>寻道时间、旋转延迟、传输时间</strong>三个部分，寻道时间指的是磁臂移动到指定磁道所需要的时间，主流磁盘一般在5ms以下；旋转延迟就是我们经常听说的磁盘转速，比如一个磁盘7200转，表示每分钟能转7200次，也就是说1秒钟能转120次，旋转延迟就是1/120/2 = 4.17ms；传输时间指的是从磁盘读出或将数据写入磁盘的时间，一般在零点几毫秒，相对于前两个时间可以忽略不计。那么访问一次磁盘的时间，即一次磁盘IO的时间约等于5+4.17 = 9ms左右，听起来还挺不错的，但要知道一台500 -MIPS的机器每秒可以执行5亿条指令，因为指令依靠的是电的性质，换句话说执行一次IO的时间可以执行40万条指令，数据库动辄十万百万乃至千万级数据，每次9毫秒的时间，显然是个灾难。</p><h3 id="mysql中的页" tabindex="-1"><a class="header-anchor" href="#mysql中的页" aria-hidden="true">#</a> mysql中的页</h3><p>mysql中和磁盘交互的最小单位称为页，页是mysql内部定义的一种数据结构，默认为16kb，相当于4个磁盘块，也就是说mysql每次从磁盘中读取一次数据是16KB，要么不读取，要读取就是16KB，此值可以修改的。</p><h3 id="数据检索过程" tabindex="-1"><a class="header-anchor" href="#数据检索过程" aria-hidden="true">#</a> 数据检索过程</h3><p>我们对数据存储方式不做任何优化，直接将数据库中表的记录存储在磁盘中，假如某个表只有一个字段，为int类型，int占用4个byte，每个磁盘块可以存储1000条记录，100万的记录需要1000个磁盘块，如果我们需要从这100万记录中检索所需要的记录，需要读取1000个磁盘块的数据（需要1000次io），每次io需要9ms，那么1000次需要9000ms=9s，100条数据随便一个查询就是9秒，这种情况我们是无法接受的，显然是不行的。</p><h2 id="_3-索引分类" tabindex="-1"><a class="header-anchor" href="#_3-索引分类" aria-hidden="true">#</a> 3-索引分类</h2><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221001170042429.png" alt="image-20221001170042429" loading="lazy"></p><ul><li><strong>主键索引</strong>: InnoDB主键是默认的索引，数据列不允许重复，不允许为NULL，一 个表只能有一个主键。</li><li><strong>唯一索引</strong>: 数据列不允许重复，允许为NULL值，一个表允许多个列创建唯一索引。</li><li><strong>普通索引</strong>: 基本的索引类型，没有唯一性的限制，允许为NULL值。</li><li><strong>组合索引</strong>：多列值组成一个索引，用于组合搜索，效率大于索引合并</li></ul><h2 id="_4-为什么使用b-树" tabindex="-1"><a class="header-anchor" href="#_4-为什么使用b-树" aria-hidden="true">#</a> 4-为什么使用B+树</h2><h3 id="_1-我们需要的数据结构有什么特点" tabindex="-1"><a class="header-anchor" href="#_1-我们需要的数据结构有什么特点" aria-hidden="true">#</a> 1.我们需要的数据结构有什么特点？</h3><ol><li>需要一种数据存储结构：当从磁盘中检索数据的时候能，够减少磁盘的io次数，最好能够降低到一个稳定的常量值</li><li>需要一种检索算法：当从磁盘中读取磁盘块的数据之后，这些块中可能包含多条记录，这些记录被加载到内存中，那么需要一种算法能够快速从内存多条记录中快速检索出目标数据</li></ol><p>我们来找找，看是否能够找到这样的算法和数据结构。</p><p>我们看一下常见的检索算法和数据结构。</p><h3 id="_2-循环遍历" tabindex="-1"><a class="header-anchor" href="#_2-循环遍历" aria-hidden="true">#</a> 2.循环遍历</h3><p>从一组无序的数据中查找目标数据，常见的方法是遍历查询，n条数据，时间复杂度为O(n)，最快需要1次，最坏的情况需要n次，查询效率不稳定。</p><h3 id="_3-二分查找" tabindex="-1"><a class="header-anchor" href="#_3-二分查找" aria-hidden="true">#</a> 3.二分查找</h3><p>二分法查找也称为折半查找，用于在一个有序数组中快速定义某一个需要查找的数据。</p><p><strong>原理是：</strong></p><p>先将一组无序的数据排序（升序或者降序）之后放在数组中，此处用升序来举例说明：用数组中间位置的数据A和需要查找的数据F对比，如果A=F，则结束查找；如果AF，则将查找范围缩小至数组中A数据左边的部分，继续按照上面的方法直到找到F为止。</p><p><strong>示例：</strong></p><blockquote><p>从下列有序数字中查找数字9，过程如下</p></blockquote><p>[1,2,3,4,5,6,7,8,9]</p><p>第1次查找：[1,2,3,4,5,6,7,8,9]中间位置值为5，9&gt;5，将查找范围缩小至5右边的部分：[6、7、8、9]</p><p>第2次查找：[6、7、8、9]中间值为8，9&gt;8 ，将范围缩小至8右边部分：[9]</p><p>第3次查找：在[9]中查找9，找到了。</p><p>可以看到查找速度是相当快的，每次查找都会使范围减半，如果我们采用顺序查找，上面数据最快需要1次，最多需要9次，而二分法查找最多只需要3次，耗时时间也比较稳定。</p><p>二分法查找时间复杂度是:<strong>O(logN)(N为数据量)</strong>，100万数据查找最多只需要20次（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>20</mn></msup></mrow><annotation encoding="application/x-tex">2^{20}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">20</span></span></span></span></span></span></span></span></span></span></span></span>=1048576‬）</p><p><strong>二分法查找数据的优点：定位数据非常快，前提是：目标数组是有序的。</strong></p><h3 id="_4-有序数组" tabindex="-1"><a class="header-anchor" href="#_4-有序数组" aria-hidden="true">#</a> 4.有序数组</h3><p>如果我们将mysql中表的数据以有序数组的方式存储在磁盘中，那么我们定位数据步骤是：</p><ol><li>取出目标表的所有数据，存放在一个有序数组中</li><li>如果目标表的数据量非常大，从磁盘中加载到内存中需要的内存也非常大</li></ol><p>步骤取出所有数据耗费的io次数太多，步骤2耗费的内存空间太大，还有新增数据的时候，为了保证数组有序，插入数据会涉及到数组内部数据的移动，也是比较耗时的，显然用这种方式存储数据是不可取的。</p><h3 id="_5-链表" tabindex="-1"><a class="header-anchor" href="#_5-链表" aria-hidden="true">#</a> 5.链表</h3><h3 id="单链表" tabindex="-1"><a class="header-anchor" href="#单链表" aria-hidden="true">#</a> 单链表</h3><blockquote><p>每个节点中有持有指向下一个节点的指针，只能按照一个方向遍历链表，结构如下：</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//单项链表
class Node1{
    private Object data;//存储数据
    private Node1 nextNode;//指向下一个节点
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="双向链表" tabindex="-1"><a class="header-anchor" href="#双向链表" aria-hidden="true">#</a> 双向链表</h3><blockquote><p>每个节点中两个指针，分别指向当前节点的上一个节点和下一个节点，结构如下：</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//双向链表
class Node2{
    private Object data;//存储数据
    private Node1 prevNode;//指向上一个节点
    private Node1 nextNode;//指向下一个节点
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="链表的优点" tabindex="-1"><a class="header-anchor" href="#链表的优点" aria-hidden="true">#</a> 链表的优点：</h3><ol><li><strong>可以快速定位到上一个或者下一个节点</strong></li><li><strong>可以快速删除数据，只需改变指针的指向即可，这点比数组好</strong></li></ol><h3 id="链表的缺点" tabindex="-1"><a class="header-anchor" href="#链表的缺点" aria-hidden="true">#</a> 链表的缺点：</h3><ol><li><strong>无法向数组那样，通过下标随机访问数据</strong></li><li><strong>查找数据需从第一个节点开始遍历，不利于数据的查找，查找时间和无需数据类似，需要全遍历，最差时间是O(N)</strong></li></ol><h3 id="_6-二叉查找树" tabindex="-1"><a class="header-anchor" href="#_6-二叉查找树" aria-hidden="true">#</a> 6.二叉查找树</h3><p>二叉树是每个结点最多有两个子树的树结构，通常子树被称作“左子树”（left subtree）和“右子树”（right subtree）。二叉树常被用于实现二叉查找树和二叉堆。二叉树有如下特性：</p><blockquote><p>1、每个结点都包含一个元素以及n个子树，这里0≤n≤2。 2、左子树和右子树是有顺序的，次序不能任意颠倒，左子树的值要小于父结点，右子树的值要大于父结点。</p></blockquote><p>数组[20,10,5,15,30,25,35]使用二叉查找树存储如下：</p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143311866.png" alt="image-20221006143311866" loading="lazy"></p><p>每个节点上面有两个指针（left,rigth），可以通过这2个指针快速访问左右子节点，检索任何一个数据最多只需要访问3个节点，相当于访问了3次数据，时间为O(logN)，和二分法查找效率一样，查询数据还是比较快的。</p><p>但是如果我们插入数据是有序的，如[5,10,15,20,30,25,35]，那么结构就变成下面这样：</p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143410721.png" alt="image-20221006143410721" loading="lazy"></p><p>二叉树退化为了一个链表结构，查询数据最差就变为了O(N)。</p><p><strong>二叉树的优缺点：</strong></p><ol><li><strong>查询数据的效率不稳定，若树左右比较平衡的时，最差情况为O(logN)，如果插入数据是有序的，退化为了链表，查询时间变成了O(N)</strong></li><li><strong>数据量大的情况下，会导致树的高度变高，如果每个节点对应磁盘的一个块来存储一条数据，需io次数大幅增加，显然用此结构来存储数据是不可取的</strong></li></ol><h3 id="_7-avl树" tabindex="-1"><a class="header-anchor" href="#_7-avl树" aria-hidden="true">#</a> 7.AVL树</h3><p>平衡二叉树是一种特殊的二叉树，所以他也满足前面说到的二叉查找树的两个特性，同时还有一个特性：</p><blockquote><p>它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树。</p></blockquote><p>平衡二叉树相对于二叉树来说，树的左右比较平衡，不会出现二叉树那样退化成链表的情况，不管怎么插入数据，最终通过一些调整，都能够保证树左右高度相差不大于1。</p><p>这样可以让查询速度比较稳定，查询中遍历节点控制在O(logN)范围内</p><p>如果数据都存储在内存中，采用AVL树来存储，还是可以的，查询效率非常高。不过我们的数据是存在磁盘中，用过采用这种结构，每个节点对应一个磁盘块，数据量大的时候，也会和二叉树一样，会导致树的高度变高，增加了io次数，显然用这种结构存储数据也是不可取的。</p><h3 id="_8-b-树" tabindex="-1"><a class="header-anchor" href="#_8-b-树" aria-hidden="true">#</a> 8.B-树</h3><p><code>B杠树</code>，千万不要读作B减树了，B-树在是平衡二叉树上进化来的，前面介绍的几种树，每个节点上面只有一个元素，而B-树节点中可以放多个元素，主要是为了降低树的高度。</p><p>一棵m阶的B-Tree有如下特性【特征描述的有点绕，看不懂的可以跳过，看后面的图】：</p><blockquote><ol><li>每个节点最多有m个孩子，m称为b树的阶</li><li>除了根节点和叶子节点外，其它每个节点至少有Ceil(m/2)个孩子</li><li>若根节点不是叶子节点，则至少有2个孩子</li><li>所有叶子节点都在同一层，且不包含其它关键字信息</li><li>每个非终端节点包含n个关键字（健值）信息</li><li>关键字的个数n满足：ceil(m/2)-1 &lt;= n &lt;= m-1</li><li>ki(i=1,…n)为关键字，且关键字升序排序</li><li>Pi(i=1,…n)为指向子树根节点的指针。P(i-1)指向的子树的所有节点关键字均小于ki，但都大于k(i-1)</li></ol></blockquote><p>B-Tree结构的数据可以让系统高效的找到数据所在的磁盘块。为了描述B-Tree，首先定义一条记录为一个二元组[key, data] ，key为记录的键值，对应表中的主键值，data为一行记录中除主键外的数据。对于不同的记录，key值互不相同。</p><p>B-Tree中的每个节点根据实际情况可以包含大量的关键字信息和分支，如下图所示为一个3阶的B-Tree：</p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143519820.png" alt="image-20221006143519820" loading="lazy"></p><p>每个节点占用一个盘块的磁盘空间，一个节点上有两个升序排序的关键字和三个指向子树根节点的指针，指针存储的是子节点所在磁盘块的地址。两个键将数据划分成的三个范围域，对应三个指针指向的子树的数据的范围域。以根节点为例，关键字为17和35，P1指针指向的子树的数据范围为小于17，P2指针指向的子树的数据范围为17~35，P3指针指向的子树的数据范围为大于35。</p><p>模拟查找关键字29的过程：</p><ol><li>根据根节点找到磁盘块1，读入内存。【磁盘I/O操作第1次】</li><li>比较关键字29在区间（17,35），找到磁盘块1的指针P2</li><li>根据P2指针找到磁盘块3，读入内存。【磁盘I/O操作第2次】</li><li>比较关键字29在区间（26,30），找到磁盘块3的指针P2</li><li>根据P2指针找到磁盘块8，读入内存。【磁盘I/O操作第3次】</li><li>在磁盘块8中的关键字列表中找到关键字29</li></ol><p>分析上面过程，发现需要3次磁盘I/O操作，和3次内存查找操作，由于内存中的关键字是一个有序表结构，可以利用二分法快速定位到目标数据，而3次磁盘I/O操作是影响整个B-Tree查找效率的决定因素。</p><p>B-树相对于avl树，通过在节点中增加节点内部数据的个数来减少磁盘的io操作。</p><p>上面我们说过mysql是采用页方式来读写数据，每页是16KB，我们用B-树来存储mysql的记录，每个节点对应mysql中的一页（16KB），假如每行记录加上树节点中的1个指针占160Byte，那么每个节点可以存储1000（16KB/160byte）条数据，树的高度为3的节点大概可以存储（第一层1000+第二层<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><msup><mn>0</mn><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">1000^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">100</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>+第三层<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><msup><mn>0</mn><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">1000^{3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">100</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span>）10亿条记录，是不是非常惊讶，一个高度为3个B-树大概可以存储10亿条记录，我们从10亿记录中查找数据只需要3次io操作可以定位到目标数据所在的页，而页内部的数据又是有序的，然后将其加载到内存中用二分法查找，是非常快的。</p><p>可以看出使用B-树定位某个值还是很快的(10亿数据中3次io操作+内存中二分法)，但是也是有缺点的：<strong>B-不利于范围查找，比如上图中我们需要查找[15,36]区间的数据，需要访问7个磁盘块（1/2/7/3/8/4/9），io次数又上去了，范围查找也是我们经常用到的，所以b-树也不太适合在磁盘中存储需要检索的数据。</strong></p><h3 id="_9-b-树" tabindex="-1"><a class="header-anchor" href="#_9-b-树" aria-hidden="true">#</a> 9.B+树</h3><p>先看个b+树结构图： <img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143611883.png" alt="image-20221006143611883" loading="lazy"></p><h4 id="b-树的特征" tabindex="-1"><a class="header-anchor" href="#b-树的特征" aria-hidden="true">#</a> b+树的特征</h4><ol><li>每个结点至多有m个子女</li><li>除根结点外,每个结点至少有[m/2]个子女，根结点至少有两个子女</li><li>有k个子女的结点必有k个关键字</li><li>父节点中持有访问子节点的指针</li><li>父节点的关键字在子节点中都存在（如上面的1/20/35在每层都存在），要么是最小值，要么是最大值，如果节点中关键字是升序的方式，父节点的关键字是子节点的最小值</li><li>最底层的节点是叶子节点</li><li>除叶子节点之外，其他节点不保存数据，只保存关键字和指针</li><li>叶子节点包含了所有数据的关键字以及data，叶子节点之间用链表连接起来，可以非常方便的支持范围查找</li></ol><h4 id="b-树与b-树的几点不同" tabindex="-1"><a class="header-anchor" href="#b-树与b-树的几点不同" aria-hidden="true">#</a> b+树与b-树的几点不同</h4><ol><li>b+树中一个节点如果有k个关键字，最多可以包含k个子节点（k个关键字对应k个指针）；而b-树对应k+1个子节点（多了一个指向子节点的指针）</li><li>b+树除叶子节点之外其他节点值存储关键字和指向子节点的指针，而b-树还存储了数据，这样同样大小情况下，b+树可以存储更多的关键字</li><li>b+树叶子节点中存储了所有关键字及data，并且多个节点用链表连接，从上图中看子节点中数据从左向右是有序的，这样快速可以支撑范围查找（先定位范围的最大值和最小值，然后子节点中依靠链表遍历范围数据）</li></ol><h4 id="b-tree和b-tree该如何选择" tabindex="-1"><a class="header-anchor" href="#b-tree和b-tree该如何选择" aria-hidden="true">#</a> B-Tree和B+Tree该如何选择？</h4><ol><li>B-Tree因为非叶子结点也保存具体数据，所以在查找某个关键字的时候找到即可返回。而B+Tree所有的数据都在叶子结点，每次查找都得到叶子结点。所以在同样高度的B-Tree和B+Tree中，B-Tree查找某个关键字的效率更高。</li><li>由于B+Tree所有的数据都在叶子结点，并且结点之间有指针连接，在找大于某个关键字或者小于某个关键字的数据的时候，B+Tree只需要找到该关键字然后沿着链表遍历就可以了，而B-Tree还需要遍历该关键字结点的根结点去搜索。</li><li>由于B-Tree的每个结点（这里的结点可以理解为一个数据页）都存储主键+实际数据，而B+Tree非叶子结点只存储关键字信息，而每个页的大小有限是有限的，所以同一页能存储的B-Tree的数据会比B+Tree存储的更少。这样同样总量的数据，B-Tree的深度会更大，增大查询时的磁盘I/O次数，进而影响查询效率。</li></ol><h2 id="_5-存储引擎的索引" tabindex="-1"><a class="header-anchor" href="#_5-存储引擎的索引" aria-hidden="true">#</a> 5-存储引擎的索引</h2><h3 id="mysql的存储引擎和索引" tabindex="-1"><a class="header-anchor" href="#mysql的存储引擎和索引" aria-hidden="true">#</a> Mysql的存储引擎和索引</h3><p>mysql内部索引是由不同的引擎实现的，主要说一下InnoDB和MyISAM这两种引擎中的索引，这两种引擎中的索引都是使用b+树的结构来存储的。</p><h4 id="innodb中的索引" tabindex="-1"><a class="header-anchor" href="#innodb中的索引" aria-hidden="true">#</a> InnoDB中的索引</h4><p>Innodb中有2种索引：<strong>主键索引（聚集索引）</strong>、<strong>辅助索引（非聚集索引）</strong>。</p><p><strong>主键索引</strong>：每个表只有一个主键索引，b+树结构，叶子节点同时保存了主键的值也数据记录，其他节点只存储主键的值。</p><p><strong>辅助索引</strong>：每个表可以有多个，b+树结构，叶子节点保存了索引字段的值以及主键的值，其他节点只存储索引指端的值。</p><h4 id="myisam引擎中的索引" tabindex="-1"><a class="header-anchor" href="#myisam引擎中的索引" aria-hidden="true">#</a> MyISAM引擎中的索引</h4><p>B+树结构，MyISM使用的是非聚簇索引，非聚簇索引的两棵B+树看上去没什么不同，节点的结构完全一致只是存储的内容不同而已，主键索引B+树的节点存储了主键，辅助键索引B+树存储了辅助键。表数据存储在独立的地方，这两颗B+树的叶子节点都使用一个地址指向真正的表数据，对于表数据来说，这两个键没有任何差别。由于索引树是独立的，通过辅助键检索无需访问主键的索引树。</p><p>如下图：为了更形象说明这两种索引的区别，我们假想一个表存储了4行数据。其中Id作为主索引，Name作为辅助索引，图中清晰的显示了聚簇索引和非聚簇索引的差异。</p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143706623.png" alt="image-20221006143706623" style="zoom:80%;"><p>我们看一下上图中数据检索过程。</p><h4 id="innodb数据检索过程" tabindex="-1"><a class="header-anchor" href="#innodb数据检索过程" aria-hidden="true">#</a> InnoDB数据检索过程</h4><p>如果需要查询id=14的数据，只需要在左边的主键索引中检索就可以了。</p><p>如果需要搜索name=’Ellison’的数据，需要2步：</p><ol><li>先在辅助索引中检索到name=’Ellison’的数据，获取id为14</li><li>再到主键索引中检索id为14的记录</li></ol><p>辅助索引这个查询过程在mysql中叫做<strong>回表</strong>。</p><h4 id="myisam数据检索过程" tabindex="-1"><a class="header-anchor" href="#myisam数据检索过程" aria-hidden="true">#</a> MyISAM数据检索过程</h4><ol><li>在索引中找到对应的关键字，获取关键字对应的记录的地址</li><li>通过记录的地址查找到对应的数据记录</li></ol><p>我们用的最多的是innodb存储引擎，所以此处主要说一下innodb索引的情况，innodb中最好是采用主键查询，这样只需要一次索引，如果使用辅助索引检索，涉及到回表操作，比主键查询要耗时一些。</p><p>innodb中辅助索引为什么不像myisam那样存储记录的地址？</p><p>表中的数据发生变更的时候，会影响其他记录地址的变化，如果辅助索引中记录数据的地址，此时会受影响，而主键的值一般是很少更新的，当页中的记录发生地址变更的时候，对辅助索引是没有影响的。</p><p>我们来看一下mysql中页的结构，页是真正存储记录的地方，对应B+树中的一个节点，也是mysql中读写数据的最小单位，页的结构设计也是相当有水平的，能够加快数据的查询。</p><h3 id="页结构" tabindex="-1"><a class="header-anchor" href="#页结构" aria-hidden="true">#</a> 页结构</h3><p>mysql中页是innodb中存储数据的基本单位，也是mysql中管理数据的最小单位，和磁盘交互的时候都是以页来进行的，默认是16kb，mysql中采用b+树存储数据，页相当于b+树中的一个节点。</p><p>页的结构如下图：</p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143729344.png" alt="image-20221006143729344" loading="lazy"></p><p>每个Page都有通用的头和尾，但是中部的内容根据Page的类型不同而发生变化。Page的头部里有我们关心的一些数据，下图把Page的头部详细信息显示出来：</p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143754303.png" alt="image-20221006143754303" loading="lazy"></p><p>我们重点关注和数据组织结构相关的字段：Page的头部保存了两个指针，分别指向前一个Page和后一个Page，根据这两个指针我们很容易想象出Page链接起来就是一个双向链表的结构，如下图：</p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143807286.png" alt="image-20221006143807286" loading="lazy"></p><p>再看看Page的主体内容，我们主要关注行数据和索引的存储，他们都位于Page的User Records部分，User Records占据Page的大部分空间，User Records由一条一条的Record组成。在一个Page内部，单链表的头尾由固定内容的两条记录来表示，字符串形式的”Infimum”代表开头，”Supremum”代表结尾，这两个用来代表开头结尾的Record存储在System Records的，Infinum、Supremum和User Records组成了一个单向链表结构。最初数据是按照插入的先后顺序排列的，但是随着新数据的插入和旧数据的删除，数据物理顺序会变得混乱，但他们依然通过链表的方式保持着逻辑上的先后顺序，如下图：</p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143828396.png" alt="image-20221006143828396" loading="lazy"></p><p>把User Record的组织形式和若干Page组合起来，就看到了稍微完整的形式。</p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143842550.png" alt="image-20221006143842550" loading="lazy"></p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143900400.png" alt="image-20221006143900400" loading="lazy"></p><p>innodb为了快速查找记录，在页中定义了一个称之为page directory的目录槽（slots）,每个槽位占用两个字节（用于保存指向记录的地址），page directory中的多个slot组成了一个有序数组（可用于二分法快速定位记录，向下看），行记录被Page Directory逻辑的分成了多个块，块与块之间是有序的，能够加速记录的查找，如下图：</p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006143912681.png" alt="image-20221006143912681" loading="lazy"></p><p>看上图，每个行记录的都有一个n_owned的区域（图中粉色区域），n_owned标识所属的slot这个这个块有多少条数据，伪记录Infimum的n_owned值总是1，记录Supremum的n_owned的取值范围为[1,8]，其他用户记录n_owned的取值范围[4,8]，并且只有每个块中最大的那条记录的n_owned才会有值，其他的用户记录的n_owned为0。</p><h4 id="数据检索过程-1" tabindex="-1"><a class="header-anchor" href="#数据检索过程-1" aria-hidden="true">#</a> 数据检索过程</h4><p>在page中查询数据的时候，先通过b+树中查询方法定位到数据所在的页，然后将页内整体加载到内存中，通过二分法在page directory中检索数据，缩小范围，比如需要检索7，通过二分法查找到7位于slot2和slot3所指向的记录中间，然后从slot3指向的记录5开始向后向后一个个找，可以找到记录7，如果里面没有7，走到slot2向的记录8结束。</p><p>n_owned范围控制在[4,8]内，能保证每个slot管辖的范围内数据量控制在[4,8]个，能够加速目标数据的查找，当有数据插入的时候，page directory为了控制每个slot对应块中记录的个数（[4,8]），此时page directory中会对slot的数量进行调整。</p><h4 id="对page的结构总结一下" tabindex="-1"><a class="header-anchor" href="#对page的结构总结一下" aria-hidden="true">#</a> 对page的结构总结一下</h4><ol><li>b+树中叶子页之间用双向链表连接的，能够实现范围查找</li><li>页内部的记录之间是采用单向链表连接的，方便访问下一条记录</li><li>为了加快页内部记录的查询，对页内记录上加了个有序的稀疏索引，叫页目录（page directory）</li></ol><p>整体上来说mysql中的索引用到了b+树，链表，二分法查找，做到了快速定位目标数据，快速范围查找。</p><h2 id="_6-管理索引" tabindex="-1"><a class="header-anchor" href="#_6-管理索引" aria-hidden="true">#</a> 6-管理索引</h2><h3 id="_1-创建索引" tabindex="-1"><a class="header-anchor" href="#_1-创建索引" aria-hidden="true">#</a> 1.创建索引</h3><h4 id="方式1" tabindex="-1"><a class="header-anchor" href="#方式1" aria-hidden="true">#</a> 方式1：</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token punctuation">[</span><span class="token keyword">unique</span><span class="token punctuation">]</span> <span class="token keyword">index</span> 索引名称 <span class="token keyword">on</span> 表名<span class="token punctuation">(</span>列名<span class="token punctuation">[</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="方式2" tabindex="-1"><a class="header-anchor" href="#方式2" aria-hidden="true">#</a> 方式2：</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">alter</span> 表名 <span class="token keyword">add</span> <span class="token punctuation">[</span><span class="token keyword">unique</span><span class="token punctuation">]</span> <span class="token keyword">index</span> 索引名称 <span class="token keyword">on</span> <span class="token punctuation">(</span>列名<span class="token punctuation">[</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>如果字段是char、varchar类型，length可以小于字段实际长度，如果是blog、text等长文本类型，必须指定length。</p><p>[unique]：中括号代表可以省略，如果加上了unique，表示创建唯一索引。</p><p>如果table后面只写一个字段，就是单列索引，如果写多个字段，就是复合索引，多个字段之间用逗号隔开。</p></blockquote><h3 id="_2-删除索引" tabindex="-1"><a class="header-anchor" href="#_2-删除索引" aria-hidden="true">#</a> 2.删除索引</h3><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">index</span> 索引名称 <span class="token keyword">on</span> 表名<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-查看索引" tabindex="-1"><a class="header-anchor" href="#_3-查看索引" aria-hidden="true">#</a> 3.查看索引</h3><blockquote><p>查看某个表中所有的索引信息如下：</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> 表名<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-索引修改" tabindex="-1"><a class="header-anchor" href="#_4-索引修改" aria-hidden="true">#</a> 4.索引修改</h3><p>可以先删除索引，再重建索引。</p><h3 id="_5-案例" tabindex="-1"><a class="header-anchor" href="#_5-案例" aria-hidden="true">#</a> 5.案例</h3><h4 id="准备200万数据" tabindex="-1"><a class="header-anchor" href="#准备200万数据" aria-hidden="true">#</a> 准备200万数据</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/*建库javacode2018*/</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> javacode2018<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> javacode2018<span class="token punctuation">;</span>
<span class="token keyword">USE</span> javacode2018<span class="token punctuation">;</span>
<span class="token comment">/*建表test1*/</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> test1<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test1 <span class="token punctuation">(</span>
  id     <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
  name   <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;姓名&#39;</span><span class="token punctuation">,</span>
  sex <span class="token keyword">TINYINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;性别,1：男，2：女&#39;</span><span class="token punctuation">,</span>
  email  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*准备数据*/</span>
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> proc1<span class="token punctuation">;</span>
<span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> proc1<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
    <span class="token keyword">WHILE</span> i <span class="token operator">&lt;=</span> <span class="token number">2000000</span> <span class="token keyword">DO</span>
      <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test1 <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> email<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token string">&#39;javacode&#39;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mod</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token string">&#39;javacode&#39;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">&#39;@163.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> i<span class="token operator">%</span><span class="token number">10000</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span>
        <span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
        <span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
      <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
    <span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<span class="token keyword">CALL</span> proc1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> test1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上图中使用存储过程循环插入了200万记录，表中有4个字段，除了sex列，其他列的值都是没有重复的，表中还未建索引。</p><p>插入的200万数据中，id，name，email的值都是没有重复的。</p></blockquote><h4 id="无索引我们体验一下查询速度" tabindex="-1"><a class="header-anchor" href="#无索引我们体验一下查询速度" aria-hidden="true">#</a> 无索引我们体验一下查询速度</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name      <span class="token operator">|</span> sex <span class="token operator">|</span> email             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> javacode1 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode1<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.77</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面我们按id查询了一条记录耗时770毫秒，我们在id上面创建个索引感受一下速度。</p></blockquote><h4 id="创建索引" tabindex="-1"><a class="header-anchor" href="#创建索引" aria-hidden="true">#</a> 创建索引</h4><p>我们在id上面创建一个索引，感受一下：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx1 <span class="token keyword">on</span> test1 <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">2.82</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name      <span class="token operator">|</span> sex <span class="token operator">|</span> email             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> javacode1 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode1<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面的查询是不是非常快，耗时1毫秒都不到。</p></blockquote><p>我们在name上也创建个索引，感受一下查询的神速，如下：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> idx2 <span class="token keyword">on</span> test1<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">9.67</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">&#39;javacode1&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name      <span class="token operator">|</span> sex <span class="token operator">|</span> email             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> javacode1 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode1<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>查询快如闪电，有没有，索引是如此的神奇。</p></blockquote><h4 id="创建索引并指定长度" tabindex="-1"><a class="header-anchor" href="#创建索引并指定长度" aria-hidden="true">#</a> 创建索引并指定长度</h4><p>通过email检索一下数据</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> a<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token string">&#39;javacode1000085@163.com&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name            <span class="token operator">|</span> sex <span class="token operator">|</span> email                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> <span class="token number">1000085</span> <span class="token operator">|</span> javacode1000085 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode1000085<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">1.28</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>耗时1秒多，回头去看一下插入数据的sql，我们可以看到所有的email记录，每条记录的前面15个字符是不一样的，结尾是一样的（都是@163.com），通过前面15个字符就可以定位一个email了，那么我们可以对email创建索引的时候指定一个长度为15，这样相对于整个email字段更短一些，查询效果是一样的，这样一个页中可以存储更多的索引记录，命令如下：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx3 <span class="token keyword">on</span> test1 <span class="token punctuation">(</span>email<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">7.67</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后看一下查询效果：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> a<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token string">&#39;javacode1000085@163.com&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name            <span class="token operator">|</span> sex <span class="token operator">|</span> email                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> <span class="token number">1000085</span> <span class="token operator">|</span> javacode1000085 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode1000085<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>耗时不到1毫秒，神速。</p></blockquote><h4 id="查看表中的索引" tabindex="-1"><a class="header-anchor" href="#查看表中的索引" aria-hidden="true">#</a> 查看表中的索引</h4><p>我们看一下test1表中的所有索引，如下：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> Sub_part <span class="token operator">|</span> Packed <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span> <span class="token keyword">Comment</span> <span class="token operator">|</span> Index_comment <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="token operator">|</span> test1 <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> idx2     <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> name        <span class="token operator">|</span> A         <span class="token operator">|</span>     <span class="token number">1992727</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span>
<span class="token operator">|</span> test1 <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx1     <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> id          <span class="token operator">|</span> A         <span class="token operator">|</span>     <span class="token number">1992727</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span>
<span class="token operator">|</span> test1 <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx3     <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>     <span class="token number">1992727</span> <span class="token operator">|</span>       <span class="token number">15</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>可以看到test1表中3个索引的详细信息(索引名称、类型，字段)。</p></blockquote><h4 id="删除索引" tabindex="-1"><a class="header-anchor" href="#删除索引" aria-hidden="true">#</a> 删除索引</h4><blockquote><p>我们删除idx1，然后再列出test1表所有索引，如下：</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">drop</span> <span class="token keyword">index</span> idx1 <span class="token keyword">on</span> test1<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> Sub_part <span class="token operator">|</span> Packed <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span> <span class="token keyword">Comment</span> <span class="token operator">|</span> Index_comment <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="token operator">|</span> test1 <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> idx2     <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> name        <span class="token operator">|</span> A         <span class="token operator">|</span>     <span class="token number">1992727</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span>
<span class="token operator">|</span> test1 <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx3     <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>     <span class="token number">1992727</span> <span class="token operator">|</span>       <span class="token number">15</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-如何正确使用索引" tabindex="-1"><a class="header-anchor" href="#_7-如何正确使用索引" aria-hidden="true">#</a> 7-如何正确使用索引</h2><h3 id="_1-b-树的数据检索过程" tabindex="-1"><a class="header-anchor" href="#_1-b-树的数据检索过程" aria-hidden="true">#</a> 1.B+树的数据检索过程</h3><h4 id="唯一记录检索" tabindex="-1"><a class="header-anchor" href="#唯一记录检索" aria-hidden="true">#</a> 唯一记录检索</h4><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006145101526.png" alt="image-20221006145101526" loading="lazy"></p><p>如上图，所有的数据都是唯一的，查询105的记录，过程如下：</p><ol><li>将P1页加载到内存</li><li>在内存中采用二分法查找，可以确定105位于[100,150)中间，所以我们需要去加载100关联P4页</li><li>将P4加载到内存中，采用二分法找到105的记录后退出</li></ol><h4 id="查询某个值的所有记录" tabindex="-1"><a class="header-anchor" href="#查询某个值的所有记录" aria-hidden="true">#</a> 查询某个值的所有记录</h4><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006145119312.png" alt="image-20221006145119312" loading="lazy"></p><p>如上图，查询105的所有记录，过程如下：</p><ol><li>将P1页加载到内存</li><li>在内存中采用二分法查找，可以确定105位于[100,150)中间，100关联P4页</li><li>将P4加载到内存中，采用二分法找到最有一个小于105的记录，即100，然后通过链表从100开始向后访问，找到所有的105记录，直到遇到第一个大于100的值为止</li></ol><h4 id="范围查找" tabindex="-1"><a class="header-anchor" href="#范围查找" aria-hidden="true">#</a> 范围查找</h4><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006145135633.png" alt="image-20221006145135633" loading="lazy"></p><p>数据如上图，查询[55,150]所有记录，由于页和页之间是双向链表升序结构，页内部的数据是单项升序链表结构，所以只用找到范围的起始值所在的位置，然后通过依靠链表访问两个位置之间所有的数据即可，过程如下：</p><ol><li>将P1页加载到内存</li><li>内存中采用二分法找到55位于50关联的P3页中，150位于P5页中</li><li>将P3加载到内存中，采用二分法找到第一个55的记录，然后通过链表结构继续向后访问P3中的60、67，当P3访问完毕之后，通过P3的nextpage指针访问下一页P4中所有记录，继续遍历P4中的所有记录，直到访问到P5中的150为止。</li></ol><h4 id="模糊匹配" tabindex="-1"><a class="header-anchor" href="#模糊匹配" aria-hidden="true">#</a> 模糊匹配</h4><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006145148753.png" alt="image-20221006145148753" loading="lazy"></p><p>数据如上图。</p><h5 id="查询以f开头的所有记录" tabindex="-1"><a class="header-anchor" href="#查询以f开头的所有记录" aria-hidden="true">#</a> 查询以f开头的所有记录</h5><p>过程如下：</p><ol><li>将P1数据加载到内存中</li><li>在P1页的记录中采用二分法找到最后一个小于等于f的值，这个值是f，以及第一个大于f的，这个值是z，f指向叶节点P3，z指向叶节点P6，此时可以断定以f开头的记录可能存在于[P3,P6)这个范围的页内，即P3、P4、P5这三个页中</li><li>加载P3这个页，在内部以二分法找到第一条f开头的记录，然后以链表方式继续向后访问P4、P5中的记录，即可以找到所有已f开头的数据</li></ol><h5 id="查询包含f的记录" tabindex="-1"><a class="header-anchor" href="#查询包含f的记录" aria-hidden="true">#</a> 查询包含f的记录</h5><p>包含的查询在sql中的写法是<code>%f%</code>，通过索引我们还可以快速定位所在的页么？</p><p>可以看一下上面的数据，f在每个页中都存在，我们通过P1页中的记录是无法判断包含f的记录在那些页的，只能通过io的方式加载所有叶子节点，并且遍历所有记录进行过滤，才可以找到包含f的记录。</p><p>所以如果使用了<code>%值%</code>这种方式，索引对查询是无效的。</p><h4 id="最左匹配原则" tabindex="-1"><a class="header-anchor" href="#最左匹配原则" aria-hidden="true">#</a> 最左匹配原则</h4><blockquote><p>当b+树的数据项是复合的数据结构，比如(name,age,sex)的时候，b+树是按照从左到右的顺序来建立搜索树的，比如当(张三,20,F)这样的数据来检索的时候，b+树会优先比较name来确定下一步的所搜方向，如果name相同再依次比较age和sex，最后得到检索的数据；但当(20,F)这样的没有name的数据来的时候，b+树就不知道下一步该查哪个节点，因为建立搜索树的时候name就是第一个比较因子，必须要先根据name来搜索才能知道下一步去哪里查询。比如当(张三,F)这样的数据来检索时，b+树可以用name来指定搜索方向，但下一个字段age的缺失，所以只能把名字等于张三的数据都找到，然后再匹配性别是F的数据了， 这个是非常重要的性质，即索引的最左匹配特性。</p></blockquote><p>来一些示例我们体验一下。</p><p>下图中是3个字段(a,b,c)的联合索引，索引中数据的顺序是以<code>a asc,b asc,c asc</code>这种排序方式存储在节点中的，索引先以a字段升序，如果a相同的时候，以b字段升序，b相同的时候，以c字段升序，节点中每个数据认真看一下。</p><p><img src="https://raw.githubusercontent.com/huluhutu/blogimg/main/img/image-20221006145209789.png" alt="image-20221006145209789" loading="lazy"></p><h5 id="查询a-1的记录" tabindex="-1"><a class="header-anchor" href="#查询a-1的记录" aria-hidden="true">#</a> 查询a=1的记录</h5><p>由于页中的记录是以<code>a asc,b asc,c asc</code>这种排序方式存储的，所以a字段是有序的，可以通过二分法快速检索到，过程如下：</p><ol><li>将P1加载到内存中</li><li>在内存中对P1中的记录采用二分法找，可以确定a=1的记录位于{1,1,1}和{1,5,1}关联的范围内，这两个值子节点分别是P2、P4</li><li>加载叶子节点P2，在P2中采用二分法快速找到第一条a=1的记录，然后通过链表向下一条及下一页开始检索，直到在P4中找到第一个不满足a=1的记录为止</li></ol><h5 id="查询a-1-and-b-5的记录" tabindex="-1"><a class="header-anchor" href="#查询a-1-and-b-5的记录" aria-hidden="true">#</a> 查询a=1 and b=5的记录</h5><p>方法和上面的一样，可以确定a=1 and b=5的记录位于{1,1,1}和{1,5,1}关联的范围内，查找过程和a=1查找步骤类似。</p><h5 id="查询b-1的记录" tabindex="-1"><a class="header-anchor" href="#查询b-1的记录" aria-hidden="true">#</a> 查询b=1的记录</h5><p>这种情况通过P1页中的记录，是无法判断b=1的记录在那些页中的，只能加锁索引树所有叶子节点，对所有记录进行遍历，然后进行过滤，此时索引是无效的。</p><h5 id="按照c的值查询" tabindex="-1"><a class="header-anchor" href="#按照c的值查询" aria-hidden="true">#</a> 按照c的值查询</h5><p>这种情况和查询b=1也一样，也只能扫描所有叶子节点，此时索引也无效了。</p><h5 id="按照b和c一起查" tabindex="-1"><a class="header-anchor" href="#按照b和c一起查" aria-hidden="true">#</a> 按照b和c一起查</h5><p>这种也是无法利用索引的，也只能对所有数据进行扫描，一条条判断了，此时索引无效。</p><h5 id="按照-a-c-两个字段查询" tabindex="-1"><a class="header-anchor" href="#按照-a-c-两个字段查询" aria-hidden="true">#</a> 按照[a,c]两个字段查询</h5><p>这种只能利用到索引中的a字段了，通过a确定索引范围，然后加载a关联的所有记录，再对c的值进行过滤。</p><h5 id="查询a-1-and-b-0-and-c-1的记录" tabindex="-1"><a class="header-anchor" href="#查询a-1-and-b-0-and-c-1的记录" aria-hidden="true">#</a> 查询a=1 and b&gt;=0 and c=1的记录</h5><p>这种情况只能先确定a=1 and b&gt;=0所在页的范围，然后对这个范围的所有页进行遍历，c字段在这个查询的过程中，是无法确定c的数据在哪些页的，此时我们称c是不走索引的，只有a、b能够有效的确定索引页的范围。</p><p><strong>类似这种的还有&gt;、&lt;、between and，多字段索引的情况下，mysql会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配。</strong></p><p>上面说的各种情况，大家都多看一下图中数据，认真分析一下查询的过程，基本上都可以理解了。</p><p><strong>上面这种查询叫做最左匹配原则。</strong></p><h3 id="_2-索引区分度" tabindex="-1"><a class="header-anchor" href="#_2-索引区分度" aria-hidden="true">#</a> 2.索引区分度</h3><p>我们看2个有序数组</p><p>[1,2,3,4,5,6,7,8,8,9,10]</p><p>[1,1,1,1,1,8,8,8,8,8]</p><p>上面2个数组是有序的，都是10条记录，如果我需要检索值为8的所有记录，那个更快一些？</p><p>咱们使用二分法查找包含8的所有记录过程如下：先使用二分法找到最后一个小于8的记录，然后沿着这条记录向后获取下一个记录，和8对比，知道遇到第一个大于8的数字结束，或者到达数组末尾结束。</p><p>采用上面这种方法找到8的记录，第一个数组中更快的一些。因为第二个数组中含有8的比例更多的，需要访问以及匹配的次数更多一些。</p><p>这里就涉及到数据的区分度问题：</p><p><strong>索引区分度 = count(distint 记录) / count(记录)</strong>。</p><p>当索引区分度高的时候，检索数据更快一些，索引区分度太低，说明重复的数据比较多，检索的时候需要访问更多的记录才能够找到所有目标数据。</p><p>当索引区分度非常小的时候，基本上接近于全索引数据的扫描了，此时查询速度是比较慢的。</p><p>第一个数组索引区分度为1，第二个区分度为0.2，所以第一个检索更快的一些。</p><p><strong>所以我们创建索引的时候，尽量选择区分度高的列作为索引。</strong></p><h3 id="_3-正确使用索引" tabindex="-1"><a class="header-anchor" href="#_3-正确使用索引" aria-hidden="true">#</a> 3.正确使用索引</h3><h4 id="准备400万测试数据" tabindex="-1"><a class="header-anchor" href="#准备400万测试数据" aria-hidden="true">#</a> 准备400万测试数据</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/*建库javacode2018*/</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> javacode2018<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> javacode2018<span class="token punctuation">;</span>
<span class="token keyword">USE</span> javacode2018<span class="token punctuation">;</span>
<span class="token comment">/*建表test1*/</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> test1<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test1 <span class="token punctuation">(</span>
  id     <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
  name   <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;姓名&#39;</span><span class="token punctuation">,</span>
  sex <span class="token keyword">TINYINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;性别,1：男，2：女&#39;</span><span class="token punctuation">,</span>
  email  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*准备数据*/</span>
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> proc1<span class="token punctuation">;</span>
<span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> proc1<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
    <span class="token keyword">WHILE</span> i <span class="token operator">&lt;=</span> <span class="token number">4000000</span> <span class="token keyword">DO</span>
      <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test1 <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> email<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token string">&#39;javacode&#39;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mod</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token string">&#39;javacode&#39;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">&#39;@163.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> i<span class="token operator">%</span><span class="token number">10000</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span>
        <span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
        <span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
      <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
    <span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<span class="token keyword">CALL</span> proc1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="无索引检索效果" tabindex="-1"><a class="header-anchor" href="#无索引检索效果" aria-hidden="true">#</a> 无索引检索效果</h4><blockquote><p>400万数据，我们随便查询几个记录看一下效果。</p></blockquote><p>按照id查询记录</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name      <span class="token operator">|</span> sex <span class="token operator">|</span> email             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> javacode1 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode1<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">1.91</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>id=1的数据，表中只有一行，耗时近2秒，由于id列无索引，只能对400万数据进行全表扫描。</p></blockquote><h4 id="主键检索" tabindex="-1"><a class="header-anchor" href="#主键检索" aria-hidden="true">#</a> 主键检索</h4><blockquote><p>test1表中没有明确的指定主键，我们将id设置为主键：</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> test1 <span class="token keyword">modify</span> id <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">10.93</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> Sub_part <span class="token operator">|</span> Packed <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span> <span class="token keyword">Comment</span> <span class="token operator">|</span> Index_comment <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="token operator">|</span> test1 <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>  <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> id          <span class="token operator">|</span> A         <span class="token operator">|</span>     <span class="token number">3980477</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>id被置为主键之后，会在id上建立聚集索引，随便检索一条我们看一下效果：</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name            <span class="token operator">|</span> sex <span class="token operator">|</span> email                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> <span class="token number">1000000</span> <span class="token operator">|</span> javacode1000000 <span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> javacode1000000<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>这个速度很快，这个走的是上面介绍的<code>唯一记录检索</code>。</p></blockquote><h4 id="between-and范围检索" tabindex="-1"><a class="header-anchor" href="#between-and范围检索" aria-hidden="true">#</a> between and范围检索</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> id <span class="token operator">between</span> <span class="token number">100</span> <span class="token operator">and</span> <span class="token number">110</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>       <span class="token number">11</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>速度也很快，id上有主键索引，这个采用的上面介绍的<code>范围查找</code>可以快速定位目标数据。</p><p>但是如果范围太大，跨度的page也太多，速度也会比较慢，如下：</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> id <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">2000000</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>  <span class="token number">2000000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">1.17</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面id的值跨度太大，1所在的页和200万所在页中间有很多页需要读取，所以比较慢。</p><p><strong>所以使用between and的时候，区间跨度不要太大。</strong></p></blockquote><h4 id="in的检索" tabindex="-1"><a class="header-anchor" href="#in的检索" aria-hidden="true">#</a> in的检索</h4><blockquote><p>in方式检索数据，我们还是经常用的。</p><p>平时我们做项目的时候，建议少用表连接，比如电商中需要查询订单的信息和订单中商品的名称，可以先查询查询订单表，然后订单表中取出商品的id列表，采用in的方式到商品表检索商品信息，由于商品id是商品表的主键，所以检索速度还是比较快的。</p><p>通过id在400万数据中检索100条数据，看看效果：</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> a<span class="token punctuation">.</span>id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">100001</span><span class="token punctuation">,</span> <span class="token number">100002</span><span class="token punctuation">,</span> <span class="token number">100003</span><span class="token punctuation">,</span> <span class="token number">100004</span><span class="token punctuation">,</span> <span class="token number">100005</span><span class="token punctuation">,</span> <span class="token number">100006</span><span class="token punctuation">,</span> <span class="token number">100007</span><span class="token punctuation">,</span> <span class="token number">100008</span><span class="token punctuation">,</span> <span class="token number">100009</span><span class="token punctuation">,</span> <span class="token number">100010</span><span class="token punctuation">,</span> <span class="token number">100011</span><span class="token punctuation">,</span> <span class="token number">100012</span><span class="token punctuation">,</span> <span class="token number">100013</span><span class="token punctuation">,</span> <span class="token number">100014</span><span class="token punctuation">,</span> <span class="token number">100015</span><span class="token punctuation">,</span> <span class="token number">100016</span><span class="token punctuation">,</span> <span class="token number">100017</span><span class="token punctuation">,</span> <span class="token number">100018</span><span class="token punctuation">,</span> <span class="token number">100019</span><span class="token punctuation">,</span> <span class="token number">100020</span><span class="token punctuation">,</span> <span class="token number">100021</span><span class="token punctuation">,</span> <span class="token number">100022</span><span class="token punctuation">,</span> <span class="token number">100023</span><span class="token punctuation">,</span> <span class="token number">100024</span><span class="token punctuation">,</span> <span class="token number">100025</span><span class="token punctuation">,</span> <span class="token number">100026</span><span class="token punctuation">,</span> <span class="token number">100027</span><span class="token punctuation">,</span> <span class="token number">100028</span><span class="token punctuation">,</span> <span class="token number">100029</span><span class="token punctuation">,</span> <span class="token number">100030</span><span class="token punctuation">,</span> <span class="token number">100031</span><span class="token punctuation">,</span> <span class="token number">100032</span><span class="token punctuation">,</span> <span class="token number">100033</span><span class="token punctuation">,</span> <span class="token number">100034</span><span class="token punctuation">,</span> <span class="token number">100035</span><span class="token punctuation">,</span> <span class="token number">100036</span><span class="token punctuation">,</span> <span class="token number">100037</span><span class="token punctuation">,</span> <span class="token number">100038</span><span class="token punctuation">,</span> <span class="token number">100039</span><span class="token punctuation">,</span> <span class="token number">100040</span><span class="token punctuation">,</span> <span class="token number">100041</span><span class="token punctuation">,</span> <span class="token number">100042</span><span class="token punctuation">,</span> <span class="token number">100043</span><span class="token punctuation">,</span> <span class="token number">100044</span><span class="token punctuation">,</span> <span class="token number">100045</span><span class="token punctuation">,</span> <span class="token number">100046</span><span class="token punctuation">,</span> <span class="token number">100047</span><span class="token punctuation">,</span> <span class="token number">100048</span><span class="token punctuation">,</span> <span class="token number">100049</span><span class="token punctuation">,</span> <span class="token number">100050</span><span class="token punctuation">,</span> <span class="token number">100051</span><span class="token punctuation">,</span> <span class="token number">100052</span><span class="token punctuation">,</span> <span class="token number">100053</span><span class="token punctuation">,</span> <span class="token number">100054</span><span class="token punctuation">,</span> <span class="token number">100055</span><span class="token punctuation">,</span> <span class="token number">100056</span><span class="token punctuation">,</span> <span class="token number">100057</span><span class="token punctuation">,</span> <span class="token number">100058</span><span class="token punctuation">,</span> <span class="token number">100059</span><span class="token punctuation">,</span> <span class="token number">100060</span><span class="token punctuation">,</span> <span class="token number">100061</span><span class="token punctuation">,</span> <span class="token number">100062</span><span class="token punctuation">,</span> <span class="token number">100063</span><span class="token punctuation">,</span> <span class="token number">100064</span><span class="token punctuation">,</span> <span class="token number">100065</span><span class="token punctuation">,</span> <span class="token number">100066</span><span class="token punctuation">,</span> <span class="token number">100067</span><span class="token punctuation">,</span> <span class="token number">100068</span><span class="token punctuation">,</span> <span class="token number">100069</span><span class="token punctuation">,</span> <span class="token number">100070</span><span class="token punctuation">,</span> <span class="token number">100071</span><span class="token punctuation">,</span> <span class="token number">100072</span><span class="token punctuation">,</span> <span class="token number">100073</span><span class="token punctuation">,</span> <span class="token number">100074</span><span class="token punctuation">,</span> <span class="token number">100075</span><span class="token punctuation">,</span> <span class="token number">100076</span><span class="token punctuation">,</span> <span class="token number">100077</span><span class="token punctuation">,</span> <span class="token number">100078</span><span class="token punctuation">,</span> <span class="token number">100079</span><span class="token punctuation">,</span> <span class="token number">100080</span><span class="token punctuation">,</span> <span class="token number">100081</span><span class="token punctuation">,</span> <span class="token number">100082</span><span class="token punctuation">,</span> <span class="token number">100083</span><span class="token punctuation">,</span> <span class="token number">100084</span><span class="token punctuation">,</span> <span class="token number">100085</span><span class="token punctuation">,</span> <span class="token number">100086</span><span class="token punctuation">,</span> <span class="token number">100087</span><span class="token punctuation">,</span> <span class="token number">100088</span><span class="token punctuation">,</span> <span class="token number">100089</span><span class="token punctuation">,</span> <span class="token number">100090</span><span class="token punctuation">,</span> <span class="token number">100091</span><span class="token punctuation">,</span> <span class="token number">100092</span><span class="token punctuation">,</span> <span class="token number">100093</span><span class="token punctuation">,</span> <span class="token number">100094</span><span class="token punctuation">,</span> <span class="token number">100095</span><span class="token punctuation">,</span> <span class="token number">100096</span><span class="token punctuation">,</span> <span class="token number">100097</span><span class="token punctuation">,</span> <span class="token number">100098</span><span class="token punctuation">,</span> <span class="token number">100099</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+----------------+-----+------------------------+</span>
<span class="token operator">|</span> id     <span class="token operator">|</span> name           <span class="token operator">|</span> sex <span class="token operator">|</span> email                  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+----------------+-----+------------------------+</span>
<span class="token operator">|</span> <span class="token number">100000</span> <span class="token operator">|</span> javacode100000 <span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> javacode100000<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">100001</span> <span class="token operator">|</span> javacode100001 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode100001<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">100002</span> <span class="token operator">|</span> javacode100002 <span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> javacode100002<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span> <span class="token number">100099</span> <span class="token operator">|</span> javacode100099 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode100099<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+----------------+-----+------------------------+</span>
<span class="token number">100</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>耗时不到1毫秒，还是相当快的。</p><p>这个相当于多个分解为多个<code>唯一记录检索</code>，然后将记录合并。</p></blockquote><h4 id="多个索引时查询如何走" tabindex="-1"><a class="header-anchor" href="#多个索引时查询如何走" aria-hidden="true">#</a> 多个索引时查询如何走？</h4><blockquote><p>我们在name、sex两个字段上分别建个索引</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx1 <span class="token keyword">on</span> test1<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">13.50</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx2 <span class="token keyword">on</span> test1<span class="token punctuation">(</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">6.77</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看一下查询：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;javacode3500000&#39;</span> <span class="token operator">and</span> sex<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name            <span class="token operator">|</span> sex <span class="token operator">|</span> email                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> <span class="token number">3500000</span> <span class="token operator">|</span> javacode3500000 <span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> javacode3500000<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面查询速度很快，name和sex上各有一个索引，觉得上面走哪个索引？</p><p>有人说name位于where第一个，所以走的是name字段所在的索引，过程可以解释为这样：</p><ol><li>走name所在的索引找到<code>javacode3500000</code>对应的所有记录</li><li>遍历记录过滤出sex=2的值</li></ol></blockquote><p>我们看一下<code>name=&#39;javacode3500000&#39;</code>检索速度，确实很快，如下：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;javacode3500000&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name            <span class="token operator">|</span> sex <span class="token operator">|</span> email                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> <span class="token number">3500000</span> <span class="token operator">|</span> javacode3500000 <span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> javacode3500000<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>走name索引，然后再过滤，确实可以，速度也很快，果真和where后字段顺序有关么？我们把name和sex的顺序对调一下，如下：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> sex<span class="token operator">=</span><span class="token number">2</span> <span class="token operator">and</span> name<span class="token operator">=</span><span class="token string">&#39;javacode3500000&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name            <span class="token operator">|</span> sex <span class="token operator">|</span> email                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> <span class="token number">3500000</span> <span class="token operator">|</span> javacode3500000 <span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> javacode3500000<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>速度还是很快，这次是不是先走<code>sex</code>索引检索出数据，然后再过滤name呢？我们先来看一下<code>sex=2</code>查询速度：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> sex<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span>   <span class="token number">2000000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.36</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看上面，查询耗时360毫秒，200万数据，如果走sex肯定是不行的。</p><p>我们使用explain来看一下：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> sex<span class="token operator">=</span><span class="token number">2</span> <span class="token operator">and</span> name<span class="token operator">=</span><span class="token string">&#39;javacode3500000&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> test1 <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> idx1<span class="token punctuation">,</span>idx2     <span class="token operator">|</span> idx1 <span class="token operator">|</span> <span class="token number">62</span>      <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">50.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>possible_keys：列出了这个查询可能会走两个索引（idx1、idx2）</p><p>实际上走的却是idx1（key列：实际走的索引）。</p></blockquote><p><strong>当多个条件中有索引的时候，并且关系是and的时候，会走索引区分度高的</strong>，显然name字段重复度很低，走name查询会更快一些。</p><h4 id="模糊查询" tabindex="-1"><a class="header-anchor" href="#模糊查询" aria-hidden="true">#</a> 模糊查询</h4><blockquote><p>看两个查询</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> a<span class="token punctuation">.</span>name <span class="token operator">like</span> <span class="token string">&#39;javacode1000%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>     <span class="token number">1111</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> a<span class="token punctuation">.</span>name <span class="token operator">like</span> <span class="token string">&#39;%javacode1000%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>     <span class="token number">1111</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">1.78</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面第一个查询可以利用到name字段上面的索引，下面的查询是无法确定需要查找的值所在的范围的，只能全表扫描，无法利用索引，所以速度比较慢，这个过程上面有说过。</p></blockquote><h4 id="回表" tabindex="-1"><a class="header-anchor" href="#回表" aria-hidden="true">#</a> 回表</h4><blockquote><p>当需要查询的数据在索引树中不存在的时候，需要再次到聚集索引中去获取，这个过程叫做回表，如查询：</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;javacode3500000&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name            <span class="token operator">|</span> sex <span class="token operator">|</span> email                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> <span class="token number">3500000</span> <span class="token operator">|</span> javacode3500000 <span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> javacode3500000<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面查询是<code>*</code>，由于name列所在的索引中只有<code>name、id</code>两个列的值，不包含<code>sex、email</code>，所以上面过程如下：</p><ol><li>走name索引检索<code>javacode3500000</code>对应的记录，取出id为<code>3500000</code></li><li>在主键索引中检索出<code>id=3500000</code>的记录，获取所有字段的值</li></ol></blockquote><h4 id="索引覆盖" tabindex="-1"><a class="header-anchor" href="#索引覆盖" aria-hidden="true">#</a> 索引覆盖</h4><blockquote><p>查询中采用的索引树中包含了查询所需要的所有字段的值，不需要再去聚集索引检索数据，这种叫索引覆盖。</p></blockquote><p>我们来看一个查询：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>name <span class="token keyword">from</span> test1 <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;javacode3500000&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>name对应idx1索引，id为主键，所以idx1索引树叶子节点中包含了name、id的值，这个查询只用走idx1这一个索引就可以了，如果select后面使用<code>*</code>，还需要一次回表获取sex、email的值。</p><p>所以写sql的时候，尽量避免使用<code>*</code>，<code>*</code>可能会多一次回表操作，需要看一下是否可以使用索引覆盖来实现，效率更高一些。</p></blockquote><h4 id="索引下推" tabindex="-1"><a class="header-anchor" href="#索引下推" aria-hidden="true">#</a> 索引下推</h4><blockquote><p>简称ICP，Index Condition Pushdown(ICP)是MySQL 5.6中新特性，是一种在存储引擎层使用索引过滤数据的一种优化方式，ICP可以减少存储引擎访问基表的次数以及MySQL服务器访问存储引擎的次数。</p></blockquote><p>举个例子来说一下：</p><blockquote><p>我们需要查询name以<code>javacode35</code>开头的，性别为1的记录数，sql如下：</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">&#39;javacode35%&#39;</span> <span class="token operator">and</span> sex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span>     <span class="token number">55556</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.19</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>过程：</p><blockquote><ol><li>走name索引检索出以javacode35的第一条记录，得到记录的id</li><li>利用id去主键索引中查询出这条记录R1</li><li>判断R1中的sex是否为1，然后重复上面的操作，直到找到所有记录为止。</li></ol><p>上面的过程中需要走name索引以及需要回表操作。</p></blockquote><p>如果采用ICP的方式，我们可以这么做，创建一个(name,sex)的组合索引，查询过程如下：</p><blockquote><ol><li>走(name,sex)索引检索出以javacode35的第一条记录，可以得到(name,sex,id)，记做R1</li><li>判断R1.sex是否为1，然后重复上面的操作，知道找到所有记录为止</li></ol><p>这个过程中不需要回表操作了，通过索引的数据就可以完成整个条件的过滤，速度比上面的更快一些。</p></blockquote><h4 id="数字使字符串类索引失效" tabindex="-1"><a class="header-anchor" href="#数字使字符串类索引失效" aria-hidden="true">#</a> 数字使字符串类索引失效</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> test1 <span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>email<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">4000001</span><span class="token punctuation">,</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;javacode2018@163.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+------+-----+----------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name <span class="token operator">|</span> sex <span class="token operator">|</span> email                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------+-----+----------------------+</span>
<span class="token operator">|</span> <span class="token number">4000001</span> <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode2018<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------+-----+----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+------+-----+----------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name <span class="token operator">|</span> sex <span class="token operator">|</span> email                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------+-----+----------------------+</span>
<span class="token operator">|</span> <span class="token number">4000001</span> <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode2018<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------+-----+----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">65535</span> <span class="token keyword">warnings</span> <span class="token punctuation">(</span><span class="token number">3.30</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面3条sql，我们插入了一条记录。</p><p>第二条查询很快，第三条用name和1比较，name上有索引，name是字符串类型，字符串和数字比较的时候，会将字符串强制转换为数字，然后进行比较，所以第二个查询变成了全表扫描，只能取出每条数据，将name转换为数字和1进行比较。</p></blockquote><p>数字字段和字符串比较什么效果呢？如下：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token string">&#39;4000000&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name            <span class="token operator">|</span> sex <span class="token operator">|</span> email                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> <span class="token number">4000000</span> <span class="token operator">|</span> javacode4000000 <span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> javacode4000000<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">4000000</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> id      <span class="token operator">|</span> name            <span class="token operator">|</span> sex <span class="token operator">|</span> email                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token operator">|</span> <span class="token number">4000000</span> <span class="token operator">|</span> javacode4000000 <span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> javacode4000000<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------------+-----+-------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>id上面有主键索引，id是int类型的，可以看到，上面两个查询都非常快，都可以正常利用索引快速检索，所以如果字段是数组类型的，查询的值是字符串还是数组都会走索引。</p></blockquote><h4 id="函数使索引无效" tabindex="-1"><a class="header-anchor" href="#函数使索引无效" aria-hidden="true">#</a> 函数使索引无效</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> a<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> a<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;javacode1&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> a<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> concat<span class="token punctuation">(</span>a<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;javacode11&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name      <span class="token operator">|</span> sex <span class="token operator">|</span> email             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> javacode1 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode1<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">2.88</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>name上有索引，上面查询，第一个走索引，第二个不走索引，第二个使用了函数之后，name所在的索引树是无法快速定位需要查找的数据所在的页的，只能将所有页的记录加载到内存中，然后对每条数据使用函数进行计算之后再进行条件判断，此时索引无效了，变成了全表数据扫描。</p></blockquote><p><strong>结论：索引字段使用函数查询使索引无效。</strong></p><h4 id="运算符使索引无效" tabindex="-1"><a class="header-anchor" href="#运算符使索引无效" aria-hidden="true">#</a> 运算符使索引无效</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name      <span class="token operator">|</span> sex <span class="token operator">|</span> email             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> javacode1 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode1<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test1 a <span class="token keyword">where</span> id<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name      <span class="token operator">|</span> sex <span class="token operator">|</span> email             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> javacode1 <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> javacode1<span class="token variable">@163.com</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-----+-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">2.41</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>id上有主键索引，上面查询，第一个走索引，第二个不走索引，第二个使用运算符，id所在的索引树是无法快速定位需要查找的数据所在的页的，只能将所有页的记录加载到内存中，然后对每条数据的id进行计算之后再判断是否等于1，此时索引无效了，变成了全表数据扫描。</p></blockquote><p><strong>结论：索引字段使用了函数将使索引无效。</strong></p><h4 id="使用索引优化排序" tabindex="-1"><a class="header-anchor" href="#使用索引优化排序" aria-hidden="true">#</a> 使用索引优化排序</h4><p>我们有个订单表t_order(id,user_id,addtime,price)，经常会查询某个用户的订单，并且按照addtime升序排序，应该怎么创建索引呢？我们来分析一下。</p><p>在user_id上创建索引，我们分析一下这种情况，数据检索的过程：</p><ol><li>走user_id索引，找到记录的的id</li><li>通过id在主键索引中回表检索出整条数据</li><li>重复上面的操作，获取所有目标记录</li><li>在内存中对目标记录按照addtime进行排序</li></ol><p>我们要知道当数据量非常大的时候，排序还是比较慢的，可能会用到磁盘中的文件，有没有一种方式，查询出来的数据刚好是排好序的。</p><p>我们再回顾一下mysql中b+树数据的结构，记录是按照索引的值排序组成的链表，如果将user_id和addtime放在一起组成联合索引(user_id,addtime)，这样通过user_id检索出来的数据自然就是按照addtime排好序的，这样直接少了一步排序操作，效率更好，如果需addtime降序，只需要将结果翻转一下就可以了。</p><h3 id="_4-总结" tabindex="-1"><a class="header-anchor" href="#_4-总结" aria-hidden="true">#</a> 4.总结</h3><ol><li>在区分度高的字段上面建立索引可以有效的使用索引，区分度太低，无法有效的利用索引，可能需要扫描所有数据页，此时和不使用索引差不多</li><li>联合索引注意最左匹配原则：必须按照从左到右的顺序匹配，mysql会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配，比如a = 1 and b = 2 and c &gt; 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整</li><li>查询记录的时候，少使用*，尽量去利用索引覆盖，可以减少回表操作，提升效率</li><li>有些查询可以采用联合索引，进而使用到索引下推（IPC），也可以减少回表操作，提升效率</li><li>禁止对索引字段使用函数、运算符操作，会使索引失效</li><li>字符串字段和数字比较的时候会使索引无效</li><li>模糊查询’%值%’会使索引无效，变为全表扫描，但是’值%’这种可以有效利用索引</li><li>排序中尽量使用到索引字段，这样可以减少排序，提升查询效率</li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/pages/DB/MySQL/7-索引.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 842830066@qq.com">huluhutu</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/huluhutublog/pages/DB/MySQL/6-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.html" class="nav-link prev" aria-label="存储引擎"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->存储引擎</div></a><a href="/huluhutublog/pages/DB/MySQL/8-%E9%94%81.html" class="nav-link next" aria-label="锁"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">锁<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2022 huluhutu</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/huluhutublog/assets/app.0662e65c.js" defer></script>
  </body>
</html>
