<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html"><meta property="og:site_name" content="huluhutublog"><meta property="og:title" content="IOC相关注解"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-10-06T10:31:37.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2022-10-06T10:31:37.000Z"><link rel="icon" href="/huluhutublog/favicon.ico"><link rel="icon" href="/huluhutublog/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/huluhutublog/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/huluhutublog/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/huluhutublog/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/huluhutublog/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/huluhutublog/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/huluhutublog/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>IOC相关注解 | huluhutublog</title><meta name="description" content="That is my Blog!!!">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/huluhutublog/assets/style.dc69c01e.css">
    <link rel="modulepreload" href="/huluhutublog/assets/app.0662e65c.js"><link rel="modulepreload" href="/huluhutublog/assets/3-IOC相关注解.html.56cd674e.js"><link rel="modulepreload" href="/huluhutublog/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/huluhutublog/assets/3-IOC相关注解.html.d1cfdce6.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/huluhutublog/" class="brand"><img class="logo" src="/huluhutublog/logo.svg" alt="huluhutublog"><!----><span class="site-name hide-in-pad">huluhutublog</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/huluhutublog/" class="nav-link" aria-label="HULUHUTU"><span class="icon iconfont icon-home"></span>HULUHUTU<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="面试"><span class="title"><span class="icon iconfont icon-note"></span>面试</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Interviews/Java/" class="nav-link" aria-label="Java"><!---->Java<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="计算机基础"><span class="title"><span class="icon iconfont icon-note"></span>计算机基础</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/DataStructuresAndAlgorithms/" class="nav-link" aria-label="数据结构与算法"><!---->数据结构与算法<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/ComputerNetwork/" class="nav-link" aria-label="计算机网络"><!---->计算机网络<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/OperatingSystem/" class="nav-link" aria-label="操作系统"><!---->操作系统<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/PrinciplesOfComputerOrganization/" class="nav-link" aria-label="计算机组成原理"><!---->计算机组成原理<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/PrinciplesOfDatabase/" class="nav-link" aria-label="数据库原理"><!---->数据库原理<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/FundamentalsOfComputerScience/DesignPatterns/" class="nav-link" aria-label="设计模式"><!---->设计模式<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title"><span class="icon iconfont icon-note"></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Java/JavaBase/" class="nav-link" aria-label="Java基础"><!---->Java基础<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Java/JavaIO/" class="nav-link" aria-label="JavaIO"><!---->JavaIO<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Java/JavaCollection/" class="nav-link" aria-label="Java集合"><!---->Java集合<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Java/JavaConcurrent/" class="nav-link" aria-label="Java并发编程"><!---->Java并发编程<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Java/JVM/JVM.html" class="nav-link" aria-label="JVM"><!---->JVM<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title"><span class="icon iconfont icon-note"></span>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/DB/MySQL/" class="nav-link" aria-label="MySQL"><!---->MySQL<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/DB/Redis/" class="nav-link" aria-label="Redis"><!---->Redis<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring"><span class="title"><span class="icon iconfont icon-note"></span>Spring</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Spring/Spring/" class="nav-link active" aria-label="Spring"><!---->Spring<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Spring/SpringMVC/" class="nav-link" aria-label="SpringMVC"><!---->SpringMVC<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Spring/SpringBoot/" class="nav-link" aria-label="SpringBoot"><!---->SpringBoot<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Spring/SpringCloud/" class="nav-link" aria-label="SpringCloud"><!---->SpringCloud<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="消息队列"><span class="title"><span class="icon iconfont icon-note"></span>消息队列</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/MQ/RabbitMQ/" class="nav-link" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/MQ/RocketMQ/" class="nav-link" aria-label="RocketMQ"><!---->RocketMQ<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/MQ/Kafka/" class="nav-link" aria-label="Kafka"><!---->Kafka<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="分布式"><span class="title"><span class="icon iconfont icon-note"></span>分布式</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Distributed/Artritecture/" class="nav-link" aria-label="架构"><!---->架构<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/Distributed/Distributed/" class="nav-link" aria-label="分布式理论"><!---->分布式理论<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="开发工具"><span class="title"><span class="icon iconfont icon-note"></span>开发工具</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/DevelopmentTools/Git/" class="nav-link" aria-label="Git"><!---->Git<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/DevelopmentTools/Linux/" class="nav-link" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/DevelopmentTools/Docker/" class="nav-link" aria-label="Docker"><!---->Docker<!----></a></li><li class="dropdown-item"><a href="/huluhutublog/pages/DevelopmentTools/Maven/" class="nav-link" aria-label="Maven"><!---->Maven<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="项目"><span class="title"><span class="icon iconfont icon-note"></span>项目</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Project/SwiftHome/" class="nav-link" aria-label="快捷到家"><!---->快捷到家<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="部署"><span class="title"><span class="icon iconfont icon-note"></span>部署</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/huluhutublog/pages/Deploy/Blog/" class="nav-link" aria-label="vuepress"><!---->vuepress<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-note"></span><span class="title">Spring</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/huluhutublog/pages/Spring/Spring/" class="nav-link sidebar-link sidebar-page" aria-label="Spring学习指南"><!---->Spring学习指南<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/Spring/Spring/1-IOC%E4%B8%8EDI.html" class="nav-link sidebar-link sidebar-page" aria-label="IOC与DI"><!---->IOC与DI<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/Spring/Spring/2-Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" class="nav-link sidebar-link sidebar-page" aria-label="Bean的生命周期"><!---->Bean的生命周期<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="IOC相关注解"><!---->IOC相关注解<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_1-configuration" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1-@Configuration"><!---->1-@Configuration<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_2-bean" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2-@Bean"><!---->2-@Bean<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_1-怎么用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.怎么用"><!---->1.怎么用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_2-如果不使用-configuration会怎样" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.如果不使用@Configuration会怎样"><!---->2.如果不使用@Configuration会怎样<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_3-componentscan" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3-@ComponentScan"><!---->3-@ComponentScan<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_1-能做什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.能做什么"><!---->1.能做什么<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_2-工作流程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.工作流程"><!---->2.工作流程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_3-component、-repository、-service、-controller" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.@Component、@Repository、@Service、@Controller"><!---->3.@Component、@Repository、@Service、@Controller<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_4-案例1-任何参数未设置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.案例1：任何参数未设置"><!---->4.案例1：任何参数未设置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_5-案例2-指定需要扫描的包" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.案例2：指定需要扫描的包"><!---->5.案例2：指定需要扫描的包<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_6-案例-basepackageclasses指定扫描范围" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.案例：basePackageClasses指定扫描范围"><!---->6.案例：basePackageClasses指定扫描范围<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_7-includefilters的使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.includeFilters的使用"><!---->7.includeFilters的使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_8-案例-扫描包含注解的类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.案例：扫描包含注解的类"><!---->8.案例：扫描包含注解的类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_9-案例-包含指定类型的类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.案例：包含指定类型的类"><!---->9.案例：包含指定类型的类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_10-自定义filter" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.自定义Filter"><!---->10.自定义Filter<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_11-自定义filter案例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.自定义Filter案例"><!---->11.自定义Filter案例<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_12-excludefilters" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="12.excludeFilters"><!---->12.excludeFilters<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_13-componentscan重复使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="13.@ComponentScan重复使用"><!---->13.@ComponentScan重复使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_14-spring中这块的源码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="14.Spring中这块的源码"><!---->14.Spring中这块的源码<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_15-总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="15.总结"><!---->15.总结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_4-import" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4-@Import"><!---->4-@Import<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_1-为什么会有-import" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.为什么会有@Import"><!---->1.为什么会有@Import<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_2-如何使用-import" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.如何使用@Import"><!---->2.如何使用@Import<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_3-value为普通类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.value为普通类"><!---->3.value为普通类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_4-value为-configuration类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.value为@Configuration类"><!---->4.value为@Configuration类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_5-value为-componentscan类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.value为@ComponentScan类"><!---->5.value为@ComponentScan类<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_5-conditional" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5-@Conditional"><!---->5-@Conditional<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_1-conditional是干嘛的" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.@Conditional是干嘛的"><!---->1.@Conditional是干嘛的<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_2-condition接口" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.Condition接口"><!---->2.Condition接口<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_3-conditioncontext接口" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.ConditionContext接口"><!---->3.ConditionContext接口<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_4-条件判断什么时候执行" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.条件判断什么时候执行"><!---->4.条件判断什么时候执行<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_5-configurationcondition接口" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.ConfigurationCondition接口"><!---->5.ConfigurationCondition接口<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_6-案例一-阻止配置类的处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.案例一：阻止配置类的处理"><!---->6.案例一：阻止配置类的处理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_7-案例2-阻止bean的注册" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.案例2：阻止bean的注册"><!---->7.案例2：阻止bean的注册<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_8-案例3-bean不存在的时候才注册" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.案例3：bean不存在的时候才注册"><!---->8.案例3：bean不存在的时候才注册<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_9-案例4-根据环境选择配置类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.案例4：根据环境选择配置类"><!---->9.案例4：根据环境选择配置类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_10-案例5-condition指定优先级" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.案例5：Condition指定优先级"><!---->10.案例5：Condition指定优先级<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_11-案例6-configurationcondition的使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.案例6：ConfigurationCondition的使用"><!---->11.案例6：ConfigurationCondition的使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_12-总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="12.总结"><!---->12.总结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/Spring/Spring/4-DI%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html" class="nav-link sidebar-link sidebar-page" aria-label="DI相关注解"><!---->DI相关注解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/Spring/Spring/5-%20%E6%9C%89%E5%85%B3Bean%E7%89%B9%E6%80%A7%E7%9A%84%E6%B3%A8%E8%A7%A3.html" class="nav-link sidebar-link sidebar-page" aria-label="有关Bean特性的注解"><!---->有关Bean特性的注解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/Spring/Spring/6-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F.html" class="nav-link sidebar-link sidebar-page" aria-label="代理模式"><!---->代理模式<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/Spring/Spring/7-AOP.html" class="nav-link sidebar-link sidebar-page" aria-label="AOP"><!---->AOP<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/Spring/Spring/AOP%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html" class="nav-link sidebar-link sidebar-page" aria-label="AOP相关注解"><!---->AOP相关注解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/Spring/Spring/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96.html" class="nav-link sidebar-link sidebar-page" aria-label="循环依赖"><!---->循环依赖<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/huluhutublog/pages/Spring/Spring/Spring%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring设计模式"><!---->Spring设计模式<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-note"></span><span class="title">SpringMVC</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-note"></span><span class="title">SpringBoot</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-note"></span><span class="title">SpringCloud</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->IOC相关注解</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://mrhope.site" target="_blank" rel="noopener noreferrer">huluhutu</a></span><span property="author" content="huluhutu"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年10月6日</span><meta property="datePublished" content="2022-10-06T10:31:37.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 41 分钟</span><meta property="timeRequired" content="PT41M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_1-configuration" class="router-link-active router-link-exact-active toc-link level2">1-@Configuration</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_2-bean" class="router-link-active router-link-exact-active toc-link level2">2-@Bean</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_1-怎么用" class="router-link-active router-link-exact-active toc-link level3">1.怎么用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_2-如果不使用-configuration会怎样" class="router-link-active router-link-exact-active toc-link level3">2.如果不使用@Configuration会怎样</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_3-componentscan" class="router-link-active router-link-exact-active toc-link level2">3-@ComponentScan</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_1-能做什么" class="router-link-active router-link-exact-active toc-link level3">1.能做什么</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_2-工作流程" class="router-link-active router-link-exact-active toc-link level3">2.工作流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_3-component、-repository、-service、-controller" class="router-link-active router-link-exact-active toc-link level3">3.@Component、@Repository、@Service、@Controller</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_4-案例1-任何参数未设置" class="router-link-active router-link-exact-active toc-link level3">4.案例1：任何参数未设置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_5-案例2-指定需要扫描的包" class="router-link-active router-link-exact-active toc-link level3">5.案例2：指定需要扫描的包</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_6-案例-basepackageclasses指定扫描范围" class="router-link-active router-link-exact-active toc-link level3">6.案例：basePackageClasses指定扫描范围</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_7-includefilters的使用" class="router-link-active router-link-exact-active toc-link level3">7.includeFilters的使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_8-案例-扫描包含注解的类" class="router-link-active router-link-exact-active toc-link level3">8.案例：扫描包含注解的类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_9-案例-包含指定类型的类" class="router-link-active router-link-exact-active toc-link level3">9.案例：包含指定类型的类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_10-自定义filter" class="router-link-active router-link-exact-active toc-link level3">10.自定义Filter</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_11-自定义filter案例" class="router-link-active router-link-exact-active toc-link level3">11.自定义Filter案例</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_12-excludefilters" class="router-link-active router-link-exact-active toc-link level3">12.excludeFilters</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_13-componentscan重复使用" class="router-link-active router-link-exact-active toc-link level3">13.@ComponentScan重复使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_14-spring中这块的源码" class="router-link-active router-link-exact-active toc-link level3">14.Spring中这块的源码</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_15-总结" class="router-link-active router-link-exact-active toc-link level3">15.总结</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_4-import" class="router-link-active router-link-exact-active toc-link level2">4-@Import</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_1-为什么会有-import" class="router-link-active router-link-exact-active toc-link level3">1.为什么会有@Import</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_2-如何使用-import" class="router-link-active router-link-exact-active toc-link level3">2.如何使用@Import</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_3-value为普通类" class="router-link-active router-link-exact-active toc-link level3">3.value为普通类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_4-value为-configuration类" class="router-link-active router-link-exact-active toc-link level3">4.value为@Configuration类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_5-value为-componentscan类" class="router-link-active router-link-exact-active toc-link level3">5.value为@ComponentScan类</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_5-conditional" class="router-link-active router-link-exact-active toc-link level2">5-@Conditional</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_1-conditional是干嘛的" class="router-link-active router-link-exact-active toc-link level3">1.@Conditional是干嘛的</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_2-condition接口" class="router-link-active router-link-exact-active toc-link level3">2.Condition接口</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_3-conditioncontext接口" class="router-link-active router-link-exact-active toc-link level3">3.ConditionContext接口</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_4-条件判断什么时候执行" class="router-link-active router-link-exact-active toc-link level3">4.条件判断什么时候执行</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_5-configurationcondition接口" class="router-link-active router-link-exact-active toc-link level3">5.ConfigurationCondition接口</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_6-案例一-阻止配置类的处理" class="router-link-active router-link-exact-active toc-link level3">6.案例一：阻止配置类的处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_7-案例2-阻止bean的注册" class="router-link-active router-link-exact-active toc-link level3">7.案例2：阻止bean的注册</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_8-案例3-bean不存在的时候才注册" class="router-link-active router-link-exact-active toc-link level3">8.案例3：bean不存在的时候才注册</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_9-案例4-根据环境选择配置类" class="router-link-active router-link-exact-active toc-link level3">9.案例4：根据环境选择配置类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_10-案例5-condition指定优先级" class="router-link-active router-link-exact-active toc-link level3">10.案例5：Condition指定优先级</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_11-案例6-configurationcondition的使用" class="router-link-active router-link-exact-active toc-link level3">11.案例6：ConfigurationCondition的使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/huluhutublog/pages/Spring/Spring/3-IOC%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html#_12-总结" class="router-link-active router-link-exact-active toc-link level3">12.总结</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="ioc相关注解" tabindex="-1"><a class="header-anchor" href="#ioc相关注解" aria-hidden="true">#</a> IOC相关注解</h1><h2 id="_1-configuration" tabindex="-1"><a class="header-anchor" href="#_1-configuration" aria-hidden="true">#</a> 1-@Configuration</h2><p>@Configuration这个注解可以加在类上，让这个类的功能等同于一个bean xml配置文件，如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigBean</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码类似于下面的xml：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-4.3.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过<code>AnnotationConfigApplicationContext</code>来加载<code>@Configu@Configuration public class ConfigBean { }ration</code>修饰的类，如下：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ConfigBean.class);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>此时ConfigBean类中没有任何内容，相当于一个空的xml配置文件，此时我们要在ConfigBean类中注册bean，那么我们就要用到@Bean注解了。</p><h2 id="_2-bean" tabindex="-1"><a class="header-anchor" href="#_2-bean" aria-hidden="true">#</a> 2-@Bean</h2><h3 id="_1-怎么用" tabindex="-1"><a class="header-anchor" href="#_1-怎么用" aria-hidden="true">#</a> 1.怎么用</h3><p>这个注解类似于bean xml配置文件中的bean元素，用来在spring容器中注册一个bean。</p><p>@Bean注解用在方法上，表示通过方法来定义一个bean，默认将方法名称作为bean名称，将方法返回值作为bean对象，注册到spring容器中。</p><p>如：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Bean
public User user1() {
    return new User();
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@Bean注解还有很多属性，我们来看一下其源码：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE}) //@1
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Bean {
    @AliasFor(&quot;name&quot;)
    String[] value() default {};
    @AliasFor(&quot;value&quot;)
    String[] name() default {};
    @Deprecated
    Autowire autowire() default Autowire.NO;
    boolean autowireCandidate() default true;
    String initMethod() default &quot;&quot;;
    String destroyMethod() default AbstractBeanDefinition.INFER_METHOD;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>@1：说明这个注解可以用在方法和注解类型上面。</p><p>每个参数含义：</p><ol><li><p>value和name是一样的，设置的时候，这2个参数只能选一个，原因是@AliasFor导致的</p><p>@AliasFor这个注解不清楚的可以看这个文章：<a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648934095&amp;idx=1&amp;sn=26d539ef61389bae5d293f1b2f5210b2&amp;chksm=88621ef1bf1597e756ccaeb6c6c6f4b74c6e3ba22ca6adba496b05e81558cd3801c62b21b8d9&amp;token=1042984313&amp;lang=zh_CN#rd" target="_blank" rel="noopener noreferrer">详解注解<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>value：字符串数组，第一个值作为bean的名称，其他值作为bean的别名</p></li><li><p>autowire：这个参数上面标注了@Deprecated，表示已经过期了，不建议使用了</p></li><li><p>autowireCandidate：是否作为其他对象注入时候的候选bean，之前的文章中专门介绍过这个属性，不清楚的可以去看看：<a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648934008&amp;idx=1&amp;sn=ac156fe2788c49e0014bb5056139206e&amp;chksm=88621e46bf1597505eba3e716148efcd9acec72ee6c0d95cf3936be70241fd41b180f0de02b5&amp;token=1248115129&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">autowire-candidate详解<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>initMethod：bean初始化的方法，这个和生命周期有关，以后详解</p></li><li><p>destroyMethod：bean销毁的方法，也是和生命周期相关的，以后详解</p></li></ol></blockquote><h4 id="user类" tabindex="-1"><a class="header-anchor" href="#user类" aria-hidden="true">#</a> User类</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo20;
public class User {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="bean配置类-configbean" tabindex="-1"><a class="header-anchor" href="#bean配置类-configbean" aria-hidden="true">#</a> Bean配置类：ConfigBean</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo20</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigBean</span> <span class="token punctuation">{</span>
    <span class="token comment">//bean名称为方法默认值：user1</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">user1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//bean名称通过value指定了：user2Bean</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;user2Bean&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">user2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//bean名称为：user3Bean，2个别名：[user3BeanAlias1,user3BeanAlias2]</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;user3Bean&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user3BeanAlias1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user3BeanAlias2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">user3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面通过@Bean注解定义了3个bean，比较简单</p></blockquote><h4 id="来个测试类" tabindex="-1"><a class="header-anchor" href="#来个测试类" aria-hidden="true">#</a> 来个测试类</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo20;
import org.junit.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import java.util.Arrays;
public class ConfigurationTest {
    @Test
    public void test1() {
        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ConfigBean.class);//@1
        for (String beanName : context.getBeanDefinitionNames()) {
            //别名
            String[] aliases = context.getAliases(beanName);
            System.out.println(String.format(&quot;bean名称:%s,别名:%s,bean对象:%s&quot;,
                    beanName,
                    Arrays.asList(aliases),
                    context.getBean(beanName)));
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>@1：通过<code>AnnotationConfigApplicationContext</code>来加载配置类<code>ConfigBean</code>，会将配置类中所有的bean注册到spring容器中</p><p>for循环中输出了bean名称、别名、bean对象</p></blockquote><h4 id="运行test1方法输出" tabindex="-1"><a class="header-anchor" href="#运行test1方法输出" aria-hidden="true">#</a> 运行test1方法输出</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>bean名称:org.springframework.context.annotation.internalConfigurationAnnotationProcessor,别名:[],bean对象:org.springframework.context.annotation.ConfigurationClassPostProcessor@3bd82cf5
bean名称:org.springframework.context.annotation.internalAutowiredAnnotationProcessor,别名:[],bean对象:org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor@544fa968
bean名称:org.springframework.context.annotation.internalCommonAnnotationProcessor,别名:[],bean对象:org.springframework.context.annotation.CommonAnnotationBeanPostProcessor@247bddad
bean名称:org.springframework.context.event.internalEventListenerProcessor,别名:[],bean对象:org.springframework.context.event.EventListenerMethodProcessor@d35dea7
bean名称:org.springframework.context.event.internalEventListenerFactory,别名:[],bean对象:org.springframework.context.event.DefaultEventListenerFactory@7770f470
bean名称:configBean,别名:[],bean对象:com.javacode2018.lesson001.demo20.ConfigBean$$EnhancerBySpringCGLIB$$dde45976@5e5d171f
bean名称:user1,别名:[],bean对象:com.javacode2018.lesson001.demo20.User@24313fcc
bean名称:user2Bean,别名:[],bean对象:com.javacode2018.lesson001.demo20.User@7d20d0b
bean名称:user3Bean,别名:[user3BeanAlias2, user3BeanAlias1],bean对象:com.javacode2018.lesson001.demo20.User@77f1baf5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面的输出，我们主要关注与最后4行，前面的可以先忽略。</p><p>从输出中可以看出，有个名称为<code>configBean</code>的bean，正是ConfigBean这个类型，可以得出，被@Configuration修饰的类，也被注册到spring容器中了</p><p>最后3行输出就是几个User的bean对象了。</p></blockquote><h3 id="_2-如果不使用-configuration会怎样" tabindex="-1"><a class="header-anchor" href="#_2-如果不使用-configuration会怎样" aria-hidden="true">#</a> 2.如果不使用@Configuration会怎样</h3><h4 id="新建一个configbean1类" tabindex="-1"><a class="header-anchor" href="#新建一个configbean1类" aria-hidden="true">#</a> 新建一个ConfigBean1类</h4><p>内容和ConfigBean类一样，只是将@Configuration注解去掉了，如下：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>public class ConfigBean1 {
    //bean名称为方法默认值：user1
    @Bean
    public User user1() {
        return new User();
    }
    //bean名称通过value指定了：user2Bean
    @Bean(&quot;user2Bean&quot;)
    public User user2() {
        return new User();
    }
    //bean名称为：user3Bean，2个别名：[user3BeanAlias1,user3BeanAlias2]
    @Bean({&quot;user3Bean&quot;, &quot;user3BeanAlias1&quot;, &quot;user3BeanAlias2&quot;})
    public User user3() {
        return new User();
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="来个测试用例test2" tabindex="-1"><a class="header-anchor" href="#来个测试用例test2" aria-hidden="true">#</a> 来个测试用例test2</h4><p>代码类似于test1，给spring容器传递<code>ConfigBean1</code></p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Test
public void test2() {
    AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ConfigBean1.class);
    for (String beanName : context.getBeanDefinitionNames()) {
        //别名
        String[] aliases = context.getAliases(beanName);
        System.out.println(String.format(&quot;bean名称:%s,别名:%s,bean对象:%s&quot;,
                beanName,
                Arrays.asList(aliases),
                context.getBean(beanName)));
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="运行输出" tabindex="-1"><a class="header-anchor" href="#运行输出" aria-hidden="true">#</a> 运行输出</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>bean名称:org.springframework.context.annotation.internalConfigurationAnnotationProcessor,别名:[],bean对象:org.springframework.context.annotation.ConfigurationClassPostProcessor@333291e3
bean名称:org.springframework.context.annotation.internalAutowiredAnnotationProcessor,别名:[],bean对象:org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor@479d31f3
bean名称:org.springframework.context.annotation.internalCommonAnnotationProcessor,别名:[],bean对象:org.springframework.context.annotation.CommonAnnotationBeanPostProcessor@40ef3420
bean名称:org.springframework.context.event.internalEventListenerProcessor,别名:[],bean对象:org.springframework.context.event.EventListenerMethodProcessor@498d318c
bean名称:org.springframework.context.event.internalEventListenerFactory,别名:[],bean对象:org.springframework.context.event.DefaultEventListenerFactory@6e171cd7
bean名称:configBean1,别名:[],bean对象:com.javacode2018.lesson001.demo20.ConfigBean1@402bba4f
bean名称:user1,别名:[],bean对象:com.javacode2018.lesson001.demo20.User@795cd85e
bean名称:user2Bean,别名:[],bean对象:com.javacode2018.lesson001.demo20.User@59fd97a8
bean名称:user3Bean,别名:[user3BeanAlias2, user3BeanAlias1],bean对象:com.javacode2018.lesson001.demo20.User@f5ac9e4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="分析结果" tabindex="-1"><a class="header-anchor" href="#分析结果" aria-hidden="true">#</a> 分析结果</h4><p>我们将2个输出的最后4行拿来对比一下：</p><h5 id="有-configuration注解的" tabindex="-1"><a class="header-anchor" href="#有-configuration注解的" aria-hidden="true">#</a> 有@Configuration注解的</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>bean名称:configBean,别名:[],bean对象:com.javacode2018.lesson001.demo20.ConfigBean$$EnhancerBySpringCGLIB$$dde45976@5e5d171f
bean名称:user1,别名:[],bean对象:com.javacode2018.lesson001.demo20.User@24313fcc
bean名称:user2Bean,别名:[],bean对象:com.javacode2018.lesson001.demo20.User@7d20d0b
bean名称:user3Bean,别名:[user3BeanAlias2, user3BeanAlias1],bean对象:com.javacode2018.lesson001.demo20.User@77f1baf5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="没有-configuration注解的" tabindex="-1"><a class="header-anchor" href="#没有-configuration注解的" aria-hidden="true">#</a> 没有@Configuration注解的</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>bean名称:configBean1,别名:[],bean对象:com.javacode2018.lesson001.demo20.ConfigBean1@402bba4f
bean名称:user1,别名:[],bean对象:com.javacode2018.lesson001.demo20.User@795cd85e
bean名称:user2Bean,别名:[],bean对象:com.javacode2018.lesson001.demo20.User@59fd97a8
bean名称:user3Bean,别名:[user3BeanAlias2, user3BeanAlias1],bean对象:com.javacode2018.lesson001.demo20.User@f5ac9e4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="对比得出" tabindex="-1"><a class="header-anchor" href="#对比得出" aria-hidden="true">#</a> 对比得出</h5><ol><li>对比最后3行，可以看出：<strong>有没有@Configuration注解，@Bean都会起效，都会将@Bean修饰的方法作为bean注册到容器中</strong></li><li>两个内容的第一行有点不一样，被@Configuration修饰的bean最后输出的时候带有<code>EnhancerBySpringCGLIB</code>的字样，而没有@Configuration注解的bean没有Cglib的字样；有<code>EnhancerBySpringCGLIB</code>字样的说明这个bean被cglib处理过的，变成了一个代理对象。</li></ol><h2 id="_3-componentscan" tabindex="-1"><a class="header-anchor" href="#_3-componentscan" aria-hidden="true">#</a> 3-@ComponentScan</h2><p>到目前为止，介绍了2种注册bean的方式：</p><ol><li>xml中bean元素的方式</li><li>@Bean注解标注方法的方式</li></ol><p>通常情况下，项目中大部分类都需要交给spring去管理，按照上面这2种方式，代码量还是挺大的。</p><p>为了更方便bean的注册，Spring提供了批量的方式注册bean，方便大量bean批量注册，spring中的@ComponentScan就是干这个事情的。</p><h3 id="_1-能做什么" tabindex="-1"><a class="header-anchor" href="#_1-能做什么" aria-hidden="true">#</a> 1.能做什么</h3><p>@ComponentScan用于批量注册bean。</p><p><strong>这个注解会让spring去扫描某些包及其子包中所有的类，然后将满足一定条件的类作为bean注册到spring容器容器中。</strong></p><p>具体需要扫描哪些包？以及这些包中的类满足什么条件时被注册到容器中，这些都可以通过这个注解中的参数动态配置。</p><p>先来看一下这个注解的定义：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Documented
@Repeatable(ComponentScans.class) //@1
public @interface ComponentScan {
    @AliasFor(&quot;basePackages&quot;)
    String[] value() default {};
    @AliasFor(&quot;value&quot;)
    String[] basePackages() default {};
    Class&lt;?&gt;[] basePackageClasses() default {};
    Class&lt;? extends BeanNameGenerator&gt; nameGenerator() default BeanNameGenerator.class;
    Class&lt;? extends ScopeMetadataResolver&gt; scopeResolver() default AnnotationScopeMetadataResolver.class;
    ScopedProxyMode scopedProxy() default ScopedProxyMode.DEFAULT;
    String resourcePattern() default &quot;**/*.class&quot;;
    boolean useDefaultFilters() default true;
    Filter[] includeFilters() default {};
    Filter[] excludeFilters() default {};
    boolean lazyInit() default false;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>定义上可以看出此注解可以用在任何类型上面，不过我们通常将其用在类上面。</p><p>常用参数：</p><p>value：指定需要扫描的包，如：com.javacode2018</p><p>basePackages：作用同value；value和basePackages不能同时存在设置，可二选一</p><p>basePackageClasses：指定一些类，spring容器会扫描这些类所在的包及其子包中的类</p><p>nameGenerator：自定义bean名称生成器</p><p>resourcePattern：需要扫描包中的那些资源，默认是：**/*.class，即会扫描指定包中所有的class文件</p><p>useDefaultFilters：对扫描的类是否启用默认过滤器，默认为true</p><p>includeFilters：过滤器：用来配置被扫描出来的那些类会被作为组件注册到容器中</p><p>excludeFilters：过滤器，和includeFilters作用刚好相反，用来对扫描的类进行排除的，被排除的类不会被注册到容器中</p><p>lazyInit：是否延迟初始化被注册的bean</p><p>@1：@Repeatable(ComponentScans.class)，这个注解可以同时使用多个。</p></blockquote><h3 id="_2-工作流程" tabindex="-1"><a class="header-anchor" href="#_2-工作流程" aria-hidden="true">#</a> 2.工作流程</h3><ol><li>Spring会扫描指定的包，且会递归下面子包，得到一批类的数组</li><li>然后这些类会经过上面的各种过滤器，最后剩下的类会被注册到容器中</li></ol><p>所以玩这个注解，主要关注2个问题：</p><p>第一个：需要扫描哪些包？通过<code>value、backPackages、basePackageClasses</code>这3个参数来控制</p><p>第二：过滤器有哪些？通过<code>useDefaultFilters、includeFilters、excludeFilters</code>这3个参数来控制过滤器</p><p>这两个问题搞清楚了，就可以确定哪些类会被注册到容器中。</p><p>**默认情况下，任何参数都不设置的情况下，此时，会将@ComponentScan修饰的类所在的包作为扫描包；**默认情况下useDefaultFilters为true，这个为true的时候，spring容器内部会使用默认过滤器，规则是：凡是类上有<code>@Repository、@Service、@Controller、@Component</code>这几个注解中的任何一个的，那么这个类就会被作为bean注册到spring容器中，所以默认情况下，只需在类上加上这几个注解中的任何一个，这些类就会自动交给spring容器来管理了。</p><h3 id="_3-component、-repository、-service、-controller" tabindex="-1"><a class="header-anchor" href="#_3-component、-repository、-service、-controller" aria-hidden="true">#</a> 3.@Component、@Repository、@Service、@Controller</h3><p>这几个注解都是spring提供的。</p><p>先说一下<code>@Component</code>这个注解，看一下其定义：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Indexed
public @interface Component {
    String value() default &quot;&quot;;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>从定义中可以看出，这个注解可以用在任何类型上面。</p><p>通常情况下将这个注解用在类上面，标注这个类为一个组件，默认情况下，被扫描的时候会被作为bean注册到容器中。</p><p>value参数：被注册为bean的时候，用来指定bean的名称，如果不指定，默认为类名首字母小写。如：类UserService对应的beanname为userService</p></blockquote><p>再来看看<code>@Repository</code>源码如下：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Component
public @interface Repository {
    @AliasFor(annotation = Component.class)
    String value() default &quot;&quot;;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Repository上面有@Component注解。</p><p>value参数上面有<code>@AliasFor(annotation = Component.class)</code>，设置value参数的时候，也相当于给<code>@Component</code>注解中的value设置值。</p></blockquote><p>其他两个注解<code>@Service、@Controller</code>源码和<code>@Repository</code>源码类似。</p><p>这4个注解本质上是没有任何差别，都可以用在类上面，表示这个类被spring容器扫描的时候，可以作为一个bean组件注册到spring容器中。</p><p>spring容器中对这4个注解的解析并没有进行区分，统一采用<code>@Component</code>注解的方式进行解析，所以这几个注解之间可以相互替换。</p><p>spring提供这4个注解，是为了让系统更清晰，通常情况下，系统是分层结构的，多数系统一般分为controller层、service层、dao层。</p><p>@controller通常用来标注controller层组件，@service注解标注service层的组件，@Repository标注dao层的组件，这样可以让整个系统的结构更清晰，当看到这些注解的时候，会和清晰的知道属于哪个层，对于spring来说，将这3个注解替换成@Component注解，对系统没有任何影响，产生的效果是一样的。</p><p>下面通过案例来感受@ComponentScan各种用法。</p><h3 id="_4-案例1-任何参数未设置" tabindex="-1"><a class="header-anchor" href="#_4-案例1-任何参数未设置" aria-hidden="true">#</a> 4.案例1：任何参数未设置</h3><h4 id="usercontroller" tabindex="-1"><a class="header-anchor" href="#usercontroller" aria-hidden="true">#</a> UserController</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test1.controller;
import org.springframework.stereotype.Controller;
@Controller
public class UserController {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="userservice" tabindex="-1"><a class="header-anchor" href="#userservice" aria-hidden="true">#</a> UserService</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test1.service;
import org.springframework.stereotype.Service;
@Service
public class UserService {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="userdao" tabindex="-1"><a class="header-anchor" href="#userdao" aria-hidden="true">#</a> UserDao</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test1.dao;
import org.springframework.stereotype.Repository;
@Repository
public class UserDao {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="usermodel" tabindex="-1"><a class="header-anchor" href="#usermodel" aria-hidden="true">#</a> UserModel</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test1;
import org.springframework.stereotype.Component;
@Component
public class UserModel {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面几个类中，分别使用了4种注解。</p><h4 id="compontentscan修饰的类" tabindex="-1"><a class="header-anchor" href="#compontentscan修饰的类" aria-hidden="true">#</a> @CompontentScan修饰的类</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test1;
import org.springframework.context.annotation.ComponentScan;
@ComponentScan
public class ScanBean1 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="测试用例" tabindex="-1"><a class="header-anchor" href="#测试用例" aria-hidden="true">#</a> 测试用例</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22;
import com.javacode2018.lesson001.demo22.test1.ScanBean1;
import org.junit.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
public class ComponentScanTest {
    @Test
    public void test1() {
      	AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ScanBean1.class);
        for (String beanName : context.getBeanDefinitionNames()) {
            System.out.println(beanName + &quot;-&gt;&quot; + context.getBean(beanName));
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>@1：使用AnnotationConfigApplicationContext作为ioc容器，将<code>ScanBean</code>作为参数传入。</p><p><strong>默认会扫描<code>ScanBean</code>类所在的包中的所有类</strong>，类上有@Component、@Repository、@Service、@Controller任何一个注解的都会被注册到容器中</p></blockquote><h4 id="运行输出-1" tabindex="-1"><a class="header-anchor" href="#运行输出-1" aria-hidden="true">#</a> 运行输出</h4><p>部分输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>userModel-&gt;com.javacode2018.lesson001.demo22.test1.UserModel@595b007d
userController-&gt;com.javacode2018.lesson001.demo22.test1.controller.UserController@72d1ad2e
userDao-&gt;com.javacode2018.lesson001.demo22.test1.dao.UserDao@2d7275fc
userService-&gt;com.javacode2018.lesson001.demo22.test1.service.UserService@399f45b1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意最后4行这几个bean，都被注册成功了。</p></blockquote><h3 id="_5-案例2-指定需要扫描的包" tabindex="-1"><a class="header-anchor" href="#_5-案例2-指定需要扫描的包" aria-hidden="true">#</a> 5.案例2：指定需要扫描的包</h3><p>指定需要扫毛哪些包，可以通过value或者basePackage来配置，二者选其一，都配置运行会报错，下面我们通过value来配置。</p><h4 id="scanbean2" tabindex="-1"><a class="header-anchor" href="#scanbean2" aria-hidden="true">#</a> ScanBean2</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test2;
import org.springframework.context.annotation.ComponentScan;
@ComponentScan({
        &quot;com.javacode2018.lesson001.demo22.test1.controller&quot;,
        &quot;com.javacode2018.lesson001.demo22.test1.service&quot;
})
public class ScanBean2 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面指定了2需要扫描的包，这两个包中有2个类。</p></blockquote><h4 id="测试用例-1" tabindex="-1"><a class="header-anchor" href="#测试用例-1" aria-hidden="true">#</a> 测试用例</h4><p>ComponentScanTest中新增个方法</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Test
public void test2() {
    AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ScanBean2.class);
    for (String beanName : context.getBeanDefinitionNames()) {
        System.out.println(beanName + &quot;-&gt;&quot; + context.getBean(beanName));
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="运行输出-2" tabindex="-1"><a class="header-anchor" href="#运行输出-2" aria-hidden="true">#</a> 运行输出</h4><p>截取了关键几行如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>userController-&gt;com.javacode2018.lesson001.demo22.test1.controller.UserController@dd8ba08
userService-&gt;com.javacode2018.lesson001.demo22.test1.service.UserService@245b4bdc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出只有controller包和service包中的2个类被注册为bean了。</p><h4 id="注意" tabindex="-1"><a class="header-anchor" href="#注意" aria-hidden="true">#</a> 注意</h4><p><strong>指定包名的方式扫描存在的一个隐患，若包被重名了，会导致扫描会失效，一般情况下面我们使用basePackageClasses的方式来指定需要扫描的包，这个参数可以指定一些类型，默认会扫描这些类所在的包及其子包中所有的类，这种方式可以有效避免这种问题。</strong></p><p>下面来看一下basePackageClasses的方式。</p><h3 id="_6-案例-basepackageclasses指定扫描范围" tabindex="-1"><a class="header-anchor" href="#_6-案例-basepackageclasses指定扫描范围" aria-hidden="true">#</a> 6.案例：basePackageClasses指定扫描范围</h3><p>我们可以在需要扫描的包中定义一个标记的接口或者类，他们的唯一的作用是作为basePackageClasses的值，其他没有任何用途。</p><h4 id="下面我们定义这样一个接口" tabindex="-1"><a class="header-anchor" href="#下面我们定义这样一个接口" aria-hidden="true">#</a> 下面我们定义这样一个接口</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test6.beans;
public interface ScanClass {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="再来定义2个类-用-component注解标记" tabindex="-1"><a class="header-anchor" href="#再来定义2个类-用-component注解标记" aria-hidden="true">#</a> 再来定义2个类，用@Component注解标记</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test6.beans;
import org.springframework.stereotype.Component;
@Component
public class Service1 {
}

package com.javacode2018.lesson001.demo22.test6.beans;
import org.springframework.stereotype.Component;
@Component
public class Service2 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="来一个-compontentscan标记的类" tabindex="-1"><a class="header-anchor" href="#来一个-compontentscan标记的类" aria-hidden="true">#</a> 来一个@CompontentScan标记的类</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test6;
import com.javacode2018.lesson001.demo22.test6.beans.ScanClass;
import org.springframework.context.annotation.ComponentScan;
@ComponentScan(basePackageClasses = ScanClass.class)
public class ScanBean6 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="测试用例-2" tabindex="-1"><a class="header-anchor" href="#测试用例-2" aria-hidden="true">#</a> 测试用例</h4><p>ComponentScanTest中新增个方法</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Test
public void test6() {
    AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ScanBean6.class);
    for (String beanName : context.getBeanDefinitionNames()) {
        System.out.println(beanName + &quot;-&gt;&quot; + context.getBean(beanName));
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="运行输出-3" tabindex="-1"><a class="header-anchor" href="#运行输出-3" aria-hidden="true">#</a> 运行输出</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>service1-&gt;com.javacode2018.lesson001.demo22.test6.beans.Service1@79924b
service2-&gt;com.javacode2018.lesson001.demo22.test6.beans.Service2@7b9a4292
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-includefilters的使用" tabindex="-1"><a class="header-anchor" href="#_7-includefilters的使用" aria-hidden="true">#</a> 7.includeFilters的使用</h3><h4 id="用法" tabindex="-1"><a class="header-anchor" href="#用法" aria-hidden="true">#</a> 用法</h4><p>再来看一下includeFilters这个参数的定义：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>Filter[] includeFilters() default {};
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>是一个<code>Filter</code>类型的数组，<strong>多个Filter之间为或者关系，即满足任意一个就可以了</strong>，看一下<code>Filter</code>的代码：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Retention(RetentionPolicy.RUNTIME)
@Target({})
@interface Filter {
    FilterType type() default FilterType.ANNOTATION;
    @AliasFor(&quot;classes&quot;)
    Class&lt;?&gt;[] value() default {};
    @AliasFor(&quot;value&quot;)
    Class&lt;?&gt;[] classes() default {};
    String[] pattern() default {};
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>可以看出Filter也是一个注解，参数：</p><p><strong>type：过滤器的类型，是个枚举类型，5种类型</strong></p><p>ANNOTATION：通过注解的方式来筛选候选者，即判断候选者是否有指定的注解</p><p>ASSIGNABLE_TYPE：通过指定的类型来筛选候选者，即判断候选者是否是指定的类型</p><p>ASPECTJ：ASPECTJ表达式方式，即判断候选者是否匹配ASPECTJ表达式</p><p>REGEX：正则表达式方式，即判断候选者的完整名称是否和正则表达式匹配</p><p>CUSTOM：用户自定义过滤器来筛选候选者，对候选者的筛选交给用户自己来判断</p><p><strong>value：和参数classes效果一样，二选一</strong></p><p><strong>classes：3种情况如下</strong></p><p>当type=FilterType.ANNOTATION时，通过classes参数可以指定一些注解，用来判断被扫描的类上是否有classes参数指定的注解</p><p>当type=FilterType.ASSIGNABLE_TYPE时，通过classes参数可以指定一些类型，用来判断被扫描的类是否是classes参数指定的类型</p><p>当type=FilterType.CUSTOM时，表示这个过滤器是用户自定义的，classes参数就是用来指定用户自定义的过滤器，自定义的过滤器需要实现org.springframework.core.type.filter.TypeFilter接口</p><p><strong>pattern：2种情况如下</strong></p><p>当type=FilterType.ASPECTJ时，通过pattern来指定需要匹配的ASPECTJ表达式的值</p><p>当type=FilterType.REGEX时，通过pattern来自正则表达式的值</p></blockquote><h3 id="_8-案例-扫描包含注解的类" tabindex="-1"><a class="header-anchor" href="#_8-案例-扫描包含注解的类" aria-hidden="true">#</a> 8.案例：扫描包含注解的类</h3><h4 id="需求" tabindex="-1"><a class="header-anchor" href="#需求" aria-hidden="true">#</a> 需求</h4><p>我们自定义一个注解，让标注有这些注解的类自动注册到容器中</p><h4 id="代码实现" tabindex="-1"><a class="header-anchor" href="#代码实现" aria-hidden="true">#</a> 代码实现</h4><p>下面的代码都在<code>com.javacode2018.lesson001.demo22.test3</code>包中。</p><h5 id="定义一个注解" tabindex="-1"><a class="header-anchor" href="#定义一个注解" aria-hidden="true">#</a> 定义一个注解</h5><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test3;
import java.lang.annotation.*;
@Documented
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface MyBean {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="创建一个类-使用这个注解标注" tabindex="-1"><a class="header-anchor" href="#创建一个类-使用这个注解标注" aria-hidden="true">#</a> 创建一个类，使用这个注解标注</h5><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test3;
@MyBean
public class Service1 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="再来一个类-使用spring中的-compontent标注" tabindex="-1"><a class="header-anchor" href="#再来一个类-使用spring中的-compontent标注" aria-hidden="true">#</a> 再来一个类，使用spring中的@Compontent标注</h5><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test3;
import org.springframework.stereotype.Component;
@Component
public class Service2 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="再来一个类-使用-compontentscan标注" tabindex="-1"><a class="header-anchor" href="#再来一个类-使用-compontentscan标注" aria-hidden="true">#</a> 再来一个类，使用@CompontentScan标注</h5><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test3;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.FilterType;
@ComponentScan(includeFilters = {
        @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = MyBean.class)
})
public class ScanBean3 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>上面指定了Filter的type为注解的类型，只要类上面有<code>@MyBean</code>注解的，都会被作为bean注册到容器中。</p></blockquote><h5 id="测试用例-3" tabindex="-1"><a class="header-anchor" href="#测试用例-3" aria-hidden="true">#</a> 测试用例</h5><p>ComponentScanTest中新增个测试用例</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Test
public void test3() {
    AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ScanBean3.class);
    for (String beanName : context.getBeanDefinitionNames()) {
        System.out.println(beanName + &quot;-&gt;&quot; + context.getBean(beanName));
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="运行输出-截取了主要的几行" tabindex="-1"><a class="header-anchor" href="#运行输出-截取了主要的几行" aria-hidden="true">#</a> 运行输出，截取了主要的几行</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>service1-&gt;com.javacode2018.lesson001.demo22.test3.
Service1@6b81ce95service2-&gt;com.javacode2018.lesson001.demo22.test3.Service2@2a798d51
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Service1上标注了<code>@MyBean</code>注解，被注册到容器了，但是<code>Service2</code>上没有标注<code>@MyBean</code>啊，怎么也被注册到容器了？</strong></p><p><strong>原因：Service2上标注了<code>@Compontent</code>注解，而@CompontentScan注解中的<code>useDefaultFilters</code>默认是<code>true</code>，表示也会启用默认的过滤器，而默认的过滤器会将标注有<code>@Component、@Repository、@Service、@Controller</code>这几个注解的类也注册到容器中</strong></p><p>如果我们只想将标注有<code>@MyBean</code>注解的bean注册到容器，需要将默认过滤器关闭，即：useDefaultFilters=false，我们修改一下ScanBean3的代码如下：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@ComponentScan(
        useDefaultFilters = false, //不启用默认过滤器
        includeFilters = {
                @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = MyBean.class)
        })
public class ScanBean3 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再次运行<code>test3</code>输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>service1-&gt;com.javacode2018.lesson001.demo22.test3.Service1@294425a7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="扩展-自定义注解支持定义bean名称" tabindex="-1"><a class="header-anchor" href="#扩展-自定义注解支持定义bean名称" aria-hidden="true">#</a> 扩展：自定义注解支持定义bean名称</h4><p>上面的自定义的@MyBean注解，是无法指定bean的名称的，可以对这个注解做一下改造，加个value参数来指定bean的名称，如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span> <span class="token comment">//@1</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> <span class="token class-name">Component</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//@2</span>
    <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">//@3</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>重点在于@1和@2这2个地方的代码，通过上面的参数可以间接给@Component注解中的value设置值。</p><p>这块用到了@AliasFor注解，对这块不了解的，可以去看一下：<a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648934137&amp;idx=1&amp;sn=3775d5d7a23c43616d1274b0b52a9f99&amp;chksm=88621ec7bf1597d1b16d91cfb28e63bef485f10883c7ca30d09838667f65e3d214b9e1cebd47&amp;token=1372043037&amp;lang=zh_CN#rd" target="_blank" rel="noopener noreferrer">java注解详解及spring对注解的增强<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>修改一下Service1的代码：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@MyBean(&quot;service1Bean&quot;)
public class Service1 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行test3用例输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>service1Bean-&gt;com.javacode2018.lesson001.demo22.test3.Service1@222545dc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>此时bean名称就变成了<code>service1Bean</code>。</p><h3 id="_9-案例-包含指定类型的类" tabindex="-1"><a class="header-anchor" href="#_9-案例-包含指定类型的类" aria-hidden="true">#</a> 9.案例：包含指定类型的类</h3><p>下面的代码都位于<code>com.javacode2018.lesson001.demo22.test4</code>包中。</p><h4 id="来个接口" tabindex="-1"><a class="header-anchor" href="#来个接口" aria-hidden="true">#</a> 来个接口</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test4;
public interface IService {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>让spring来进行扫描，类型满足IService的都将其注册到容器中。</p><h4 id="来2个实现类" tabindex="-1"><a class="header-anchor" href="#来2个实现类" aria-hidden="true">#</a> 来2个实现类</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test4;
public class Service1 implements IService {
}

package com.javacode2018.lesson001.demo22.test4;
public class Service2 implements IService {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="来一个-compontentscan标注的类" tabindex="-1"><a class="header-anchor" href="#来一个-compontentscan标注的类" aria-hidden="true">#</a> 来一个@CompontentScan标注的类</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test4;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.FilterType;
@ComponentScan(
        useDefaultFilters = false, //不启用默认过滤器
        includeFilters = {
                @ComponentScan.Filter(type = FilterType.ASSIGNABLE_TYPE, classes = IService.class) //@1
        })
public class ScanBean4 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>@1：被扫描的类满足<code>IService.class.isAssignableFrom(被扫描的类)</code>条件的都会被注册到spring容器中</p></blockquote><h4 id="来个测试用例" tabindex="-1"><a class="header-anchor" href="#来个测试用例" aria-hidden="true">#</a> 来个测试用例</h4><p>ComponentScanTest中新增个测试用例</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Test
public void test4() {
    AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ScanBean4.class);
    for (String beanName : context.getBeanDefinitionNames()) {
        System.out.println(beanName + &quot;-&gt;&quot; + context.getBean(beanName));
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="运行输出-4" tabindex="-1"><a class="header-anchor" href="#运行输出-4" aria-hidden="true">#</a> 运行输出</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>service1-&gt;com.javacode2018.lesson001.demo22.test4.
Service1@6379ebservice2-&gt;com.javacode2018.lesson001.demo22.test4.Service2@294425a7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-自定义filter" tabindex="-1"><a class="header-anchor" href="#_10-自定义filter" aria-hidden="true">#</a> 10.自定义Filter</h3><h4 id="用法-1" tabindex="-1"><a class="header-anchor" href="#用法-1" aria-hidden="true">#</a> 用法</h4><p>有时候我们需要用到自定义的过滤器，使用自定义过滤器的步骤：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.设置@Filter中type的类型为：FilterType.CUSTOM
2.自定义过滤器类，需要实现接口：org.springframework.core.type.filter.TypeFilter
3.设置@Filter中的classses为自定义的过滤器类型
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>来看一下<code>TypeFilter</code>这个接口的定义：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@FunctionalInterface
public interface TypeFilter {
    boolean match(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)
            throws IOException;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>是一个函数式接口，包含一个match方法，方法返回boolean类型，有2个参数，都是接口类型的，下面介绍一下这2个接口。</p><h4 id="metadatareader接口" tabindex="-1"><a class="header-anchor" href="#metadatareader接口" aria-hidden="true">#</a> MetadataReader接口</h4><p><strong>类元数据读取器，可以读取一个类上的任意信息，如类上面的注解信息、类的磁盘路径信息、类的class对象的各种信息，spring进行了封装，提供了各种方便使用的方法。</strong></p><p>看一下这个接口的定义：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>public interface MetadataReader {
    /**
     * 返回类文件的资源引用
     */
    Resource getResource();
    /**
     * 返回一个ClassMetadata对象，可以通过这个读想获取类的一些元数据信息，如类的class对象、是否是接口、是否有注解、是否是抽象类、父类名称、接口名称、内部包含的之类列表等等，可以去看一下源码
     */
    ClassMetadata getClassMetadata();
    /**
     * 获取类上所有的注解信息
     */
    AnnotationMetadata getAnnotationMetadata();
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="metadatareaderfactory接口" tabindex="-1"><a class="header-anchor" href="#metadatareaderfactory接口" aria-hidden="true">#</a> MetadataReaderFactory接口</h4><p><strong>类元数据读取器工厂，可以通过这个类获取任意一个类的MetadataReader对象。</strong></p><p>源码：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>public interface MetadataReaderFactory {
    /**
     * 返回给定类名的MetadataReader对象
     */
    MetadataReader getMetadataReader(String className) throws IOException;
    /**
     * 返回指定资源的MetadataReader对象
     */
    MetadataReader getMetadataReader(Resource resource) throws IOException;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-自定义filter案例" tabindex="-1"><a class="header-anchor" href="#_11-自定义filter案例" aria-hidden="true">#</a> 11.自定义Filter案例</h3><h4 id="需求-1" tabindex="-1"><a class="header-anchor" href="#需求-1" aria-hidden="true">#</a> 需求</h4><p>我们来个自定义的Filter，判断被扫描的类如果是<code>IService</code>接口类型的，就让其注册到容器中。</p><h4 id="代码实现-1" tabindex="-1"><a class="header-anchor" href="#代码实现-1" aria-hidden="true">#</a> 代码实现</h4><p>来个自定义的TypeFilter类：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test5;
import com.javacode2018.lesson001.demo22.test4.IService;
import org.springframework.core.type.ClassMetadata;
import org.springframework.core.type.classreading.MetadataReader;
import org.springframework.core.type.classreading.MetadataReaderFactory;
import org.springframework.core.type.filter.TypeFilter;
import java.io.IOException;
public class MyFilter implements TypeFilter {
    /**
     * @param metadataReader
     * @param metadataReaderFactory
     * @return
     * @throws IOException
     */
    @Override
    public boolean match(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory) throws IOException {
        Class curClass = null;
        try {
            //当前被扫描的类
            curClass = Class.forName(metadataReader.getClassMetadata().getClassName());
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
        //判断curClass是否是IService类型
        boolean result = IService.class.isAssignableFrom(curClass);
        return result;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="来一个-compontentscan标注的类-1" tabindex="-1"><a class="header-anchor" href="#来一个-compontentscan标注的类-1" aria-hidden="true">#</a> 来一个@CompontentScan标注的类</h4><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.javacode2018.lesson001.demo22.test5;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.FilterType;
@ComponentScan(
        basePackages = {&quot;com.javacode2018.lesson001.demo22.test4&quot;},
        useDefaultFilters = false, //不启用默认过滤器
        includeFilters = {
                @ComponentScan.Filter(type = FilterType.CUSTOM, classes = MyFilter.class) //@1
        })
public class ScanBean5 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>@1：type为FilterType.CUSTOM，表示Filter是用户自定义的，classes为自定义的过滤器</p></blockquote><h4 id="再来个测试用例" tabindex="-1"><a class="header-anchor" href="#再来个测试用例" aria-hidden="true">#</a> 再来个测试用例</h4><p>ComponentScanTest中新增个测试用例</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Test
public void test5() {
    AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ScanBean5.class);
    for (String beanName : context.getBeanDefinitionNames()) {
        System.out.println(beanName + &quot;-&gt;&quot; + context.getBean(beanName));
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="运行输出-5" tabindex="-1"><a class="header-anchor" href="#运行输出-5" aria-hidden="true">#</a> 运行输出</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>service1-&gt;com.javacode2018.lesson001.demo22.test4.
Service1@4cc451f2service2-&gt;com.javacode2018.lesson001.demo22.test4.Service2@6379eb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-excludefilters" tabindex="-1"><a class="header-anchor" href="#_12-excludefilters" aria-hidden="true">#</a> 12.excludeFilters</h3><p><strong>配置排除的过滤器，满足这些过滤器的类不会被注册到容器中，用法上面和includeFilters用一样，这个我就不演示了，可以自己玩玩</strong></p><h3 id="_13-componentscan重复使用" tabindex="-1"><a class="header-anchor" href="#_13-componentscan重复使用" aria-hidden="true">#</a> 13.@ComponentScan重复使用</h3><p>从这个注解的定义上可以看出这个注解可以同时使用多个，如：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@ComponentScan(basePackageClasses = ScanClass.class)
@ComponentScan(
        useDefaultFilters = false, //不启用默认过滤器
        includeFilters = {
                @ComponentScan.Filter(type = FilterType.ASSIGNABLE_TYPE, classes = IService.class)
        })
public class ScanBean7 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还有一种写法，使用@ComponentScans的方式：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@ComponentScans({
        @ComponentScan(basePackageClasses = ScanClass.class),
        @ComponentScan(
                useDefaultFilters = false, //不启用默认过滤器
                includeFilters = {
                        @ComponentScan.Filter(type = FilterType.ASSIGNABLE_TYPE, classes = IService.class)
                })})
public class ScanBean7 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-spring中这块的源码" tabindex="-1"><a class="header-anchor" href="#_14-spring中这块的源码" aria-hidden="true">#</a> 14.Spring中这块的源码</h3><p><strong>@CompontentScan注解是被下面这个类处理的</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>org.springframework.context.annotation.ConfigurationClassPostProcessor
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>这个类非常非常关键，主要用户bean的注册，前面我们介绍的@Configuration,@Bean注解也是被这个类处理的。</strong></p><p>还有下面这些注解：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@PropertySource
@Import
@ImportResource
@Compontent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>以上这些注解都是被ConfigurationClassPostProcessor这个类处理的，内部会递归处理这些注解，完成bean的注册。</strong></p><p><strong>以@CompontentScan来说一下过程，第一次扫描之后会得到一批需要注册的类，然后会对这些需要注册的类进行遍历，判断是否有上面任意一个注解，如果有，会将这个类交给ConfigurationClassPostProcessor继续处理，直到递归完成所有bean的注册。</strong></p><p><strong>想成为高手，这个类是必看的。</strong></p><h3 id="_15-总结" tabindex="-1"><a class="header-anchor" href="#_15-总结" aria-hidden="true">#</a> 15.总结</h3><ol><li>@ComponentScan用于批量注册bean，spring会按照这个注解的配置，递归扫描指定包中的所有类，将满足条件的类批量注册到spring容器中</li><li>可以通过value、basePackages、basePackageClasses 这几个参数来配置包的扫描范围</li><li>可以通过useDefaultFilters、includeFilters、excludeFilters这几个参数来配置类的过滤器，被过滤器处理之后剩下的类会被注册到容器中</li><li>指定包名的方式配置扫描范围存在隐患，包名被重命名之后，会导致扫描实现，所以一般我们在需要扫描的包中可以创建一个标记的接口或者类，作为basePackageClasses的值，通过这个来控制包的扫描范围</li><li>@CompontScan注解会被ConfigurationClassPostProcessor类递归处理，最终得到所有需要注册的类。</li></ol><h2 id="_4-import" tabindex="-1"><a class="header-anchor" href="#_4-import" aria-hidden="true">#</a> 4-@Import</h2><h3 id="_1-为什么会有-import" tabindex="-1"><a class="header-anchor" href="#_1-为什么会有-import" aria-hidden="true">#</a> 1.为什么会有@Import</h3><p>到目前，我们知道的批量定义bean的方式有2种：</p><ol><li>@Configuration结合@Bean注解的方式</li><li>@CompontentScan扫描包的方式</li></ol><p>下面我们来看几个问题。</p><h4 id="问题1" tabindex="-1"><a class="header-anchor" href="#问题1" aria-hidden="true">#</a> 问题1</h4><p>如果需要注册的类是在第三方的jar中，那么我们如果想注册这些bean有2种方式：</p><ol><li>通过@Bean标注方法的方式，一个个来注册</li><li>@CompontentScan的方式：默认的@CompontentScan是无能为力的，默认情况下只会注册@Compontent标注的类，此时只能自定义@CompontentScan中的过滤器来实现了</li></ol><p>这2种方式都不是太好，每次有变化，调整的代码都比较多。</p><h4 id="问题2" tabindex="-1"><a class="header-anchor" href="#问题2" aria-hidden="true">#</a> 问题2</h4><p>通常我们的项目中有很多子模块，可能每个模块都是独立开发的，最后通过jar的方式引进来，每个模块中都有各自的@Configuration、@Bean标注的类，或者使用@CompontentScan标注的类，<strong>被@Configuration、@Bean、@CompontentScan标注的类，我们统称为bean配置类，配置类可以用来注册bean</strong>，此时如果我们只想使用其中几个模块的配置类，怎么办？</p><h3 id="_2-如何使用-import" tabindex="-1"><a class="header-anchor" href="#_2-如何使用-import" aria-hidden="true">#</a> 2.如何使用@Import</h3><p>先看Spring对它的注释，总结下来作用就是和xml配置的 <!---->标签作用一样，允许通过它引入@Configuration标注的类 ， 引入ImportSelector接口和ImportBeanDefinitionRegistrar接口的实现，也包括 @Component注解的普通类。</p><p><strong>总的来说：@Import可以用来批量导入需要注册的各种类，如普通的类、配置类，完后完成普通类和配置类中所有bean的注册。</strong></p><p>@Import的源码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Import</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Configuration</span></span> @Configuration<span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">ImportSelector</span></span><span class="token punctuation">}</span>,
     * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">ImportBeanDefinitionRegistrar</span></span><span class="token punctuation">}</span>, or regular component classes to import.
     */</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@Import可以使用在任何类型上，通常情况下，类和注解上用的比较多。</p><p>value：一个Class数组，设置需要导入的类，可以是@Configuration标注的列，可以是ImportSelector接口或者ImportBeanDefinitionRegistrar接口类型的，或者需要导入的普通组件类。</p><p><strong>使用步骤</strong></p><ol><li>将@Import标注在类上，设置value参数</li><li>将@Import标注的类作为AnnotationConfigApplicationContext构造参数创建AnnotationConfigApplicationContext对象</li><li>使用AnnotationConfigApplicationContext对象</li></ol><p><strong>@Import的value常见的有5种用法</strong></p><ol><li><strong>value为普通的类</strong></li><li><strong>value为@Configuration标注的类</strong></li><li><strong>value为@CompontentScan标注的类</strong></li><li><strong>value为ImportBeanDefinitionRegistrar接口类型</strong></li><li><strong>value为ImportSelector接口类型</strong></li><li><strong>value为DeferredImportSelector接口类型</strong></li></ol><h3 id="_3-value为普通类" tabindex="-1"><a class="header-anchor" href="#_3-value为普通类" aria-hidden="true">#</a> 3.value为普通类</h3><p><strong>Service1</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test1</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service1</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Service2</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test1</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service2</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>总配置类：使用@Import标注</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Import</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Service1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Service2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig1</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@Import中导入了2个普通的类：Service1、Service2，这两个类会被自动注册到容器中</p><p><strong>测试用例</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test1<span class="token punctuation">.</span></span><span class="token class-name">MainConfig1</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AnnotationConfigApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImportTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.通过AnnotationConfigApplicationContext创建spring容器，参数为@Import标注的类</span>
        <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.输出容器中定义的所有bean信息</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> beanName <span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s-&gt;%s&quot;</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>运行输出</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>com.javacode2018.lesson001.demo24.test1.Service1-&gt;com.javacode2018.lesson001.demo24.test1.Service1@7e0b85f9
com.javacode2018.lesson001.demo24.test1.Service2-&gt;com.javacode2018.lesson001.demo24.test1.Service2@63355449
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>结果分析</strong></p><p>从输出中可以看出：</p><ol><li>Service1和Service2成功注册到容器了。</li><li>通过@Import导入的2个类，bean名称为完整的类名</li></ol><p>我们也可以指定被导入类的bean名称，使用@Compontent注解就可以了，如下：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>@Component(&quot;service1&quot;)
public class Service1 {
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再次运行test1输出：</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>service1-&gt;com.javacode2018.lesson001.demo24.test1.Service1@45efd90f
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>总结</strong></p><p><strong>按模块的方式进行导入，需要哪个导入哪个，不需要的时候，直接修改一下总的配置类，调整一下@Import就可以了，非常方便。</strong></p><h3 id="_4-value为-configuration类" tabindex="-1"><a class="header-anchor" href="#_4-value为-configuration类" aria-hidden="true">#</a> 4.value为@Configuration类</h3><p>项目比较大的情况下，会按照模块独立开发，每个模块在maven中就表现为一个个的构建，然后通过坐标的方式进行引入需要的模块。</p><p>假如项目中有2个模块，2个模块都有各自的配置类，如下</p><p><strong>模块一配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * 模块1配置类
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigModule1</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">module1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;我是模块1配置类！&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>模块二配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * 模块2配置类
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigModule2</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">module2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;我是模块2配置类！&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>总配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Import</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * 通过Import来汇总多个@Configuration标注的配置类
 */</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ConfigModule1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ConfigModule2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//@1</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig2</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试用例</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//1.通过AnnotationConfigApplicationContext创建spring容器，参数为@Import标注的类</span>
    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2.输出容器中定义的所有bean信息</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> beanName <span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s-&gt;%s&quot;</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>运行输出</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mainConfig2-&gt;com.javacode2018.lesson001.demo24.test2.MainConfig2@ba2f4ec
com.javacode2018.lesson001.demo24.test2.ConfigModule1-&gt;com.javacode2018.lesson001.demo24.test2.ConfigModule1$$EnhancerBySpringCGLIB$$700e65cd@1c1bbc4e
module1-&gt;我是模块1配置类！
com.javacode2018.lesson001.demo24.test2.ConfigModule2-&gt;com.javacode2018.lesson001.demo24.test2.ConfigModule2$$EnhancerBySpringCGLIB$$a87108ee@55fe41ea
module2-&gt;我是模块2配置类！
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-value为-componentscan类" tabindex="-1"><a class="header-anchor" href="#_5-value为-componentscan类" aria-hidden="true">#</a> 5.value为@ComponentScan类</h3><p>项目中分多个模块，每个模块有各自独立的包，我们在每个模块所在的包中配置一个@CompontentScan类，然后通过@Import来导入需要启用的模块。</p><p><strong>模块1</strong></p><p>2个组件和一个组件扫描类，模块1所有类所在的包为：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>com.javacode2018.lesson001.demo24.test3.module1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>组件1：Module1Service1</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test3<span class="token punctuation">.</span>module1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Module1Service1</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>组件2：Module1Servcie2</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test3<span class="token punctuation">.</span>module1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Module1Service2</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>组件扫描类ComponentScanModule1</strong></p><p>负责扫描Module1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test3<span class="token punctuation">.</span>module1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * 模块1的主键扫描
 */</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompontentScanModule1</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>模块2</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>com.javacode2018.lesson001.demo24.test3.module2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>组件1：Module2Service1</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test3<span class="token punctuation">.</span>module2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Module2Service1</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>组件2：Module2Service2</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test3<span class="token punctuation">.</span>module2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Module2Service2</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>组件扫描类：CompontentScanModule2</strong></p><p>负责扫描当前模块中的组件</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test3<span class="token punctuation">.</span>module2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * 模块2的组件扫描
 */</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompontentScanModule2</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>总配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test3</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test3<span class="token punctuation">.</span>module1<span class="token punctuation">.</span></span><span class="token class-name">CompontentScanModule1</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo24<span class="token punctuation">.</span>test3<span class="token punctuation">.</span>module2<span class="token punctuation">.</span></span><span class="token class-name">CompontentScanModule2</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Import</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * 通过@Import导入多个@CompontentScan标注的配置类
 */</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">CompontentScanModule1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">CompontentScanModule2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//@1</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig3</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试用例</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//1.通过AnnotationConfigApplicationContext创建spring容器，参数为@Import标注的类</span>
    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig3</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2.输出容器中定义的所有bean信息</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> beanName <span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s-&gt;%s&quot;</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>运行输出</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>module1Service1-&gt;com.javacode2018.lesson001.demo24.test3.module1.Module1Service1@5b239d7d
module1Service2-&gt;com.javacode2018.lesson001.demo24.test3.module1.Module1Service2@6572421
module2Service1-&gt;com.javacode2018.lesson001.demo24.test3.module2.Module2Service1@6b81ce95
module2Service2-&gt;com.javacode2018.lesson001.demo24.test3.module2.Module2Service2@2a798d51
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>两个模块中通过@Compontent定义的4个bean都输出了。</p><p>如果只想注册模块1中的bean，只需要修改一下@Import，去掉CompontentScanModule2，如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">CompontentScanModule1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>再次运行输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>module1Service1-&gt;com.javacode2018.lesson001.demo24.test3.module1.Module1Service1@6379eb
module1Service2-&gt;com.javacode2018.lesson001.demo24.test3.module1.Module1Service2@294425a7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>此时模块2的bean就没有了。</p><h2 id="_5-conditional" tabindex="-1"><a class="header-anchor" href="#_5-conditional" aria-hidden="true">#</a> 5-@Conditional</h2><h3 id="_1-conditional是干嘛的" tabindex="-1"><a class="header-anchor" href="#_1-conditional是干嘛的" aria-hidden="true">#</a> 1.@Conditional是干嘛的</h3><p><strong>@Conditional注解是从spring4.0才有的，可以用在任何类型或者方法上面，通过@Conditional注解可以配置一些条件判断，当所有条件都满足的时候，被@Conditional标注的目标才会被spring容器处理。</strong></p><p>比如可以通过@Conditional来控制bean是否需要注册，控制被@Configuration标注的配置类是需要需要被解析等。</p><p>效果就像这段代码，相当于在spring容器解析目标前面加了一个条件判断：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Conditional</span>中配置的多个条件是否都匹配<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//spring继续处理被@Conditional注解标注的对象</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@Conditional源码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Conditional</span> <span class="token punctuation">{</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Condition</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个注解只有一个value参数，Condition类型的数组，Condition是一个接口，表示一个条件判断，<strong>内部有个方法返回true或false，当所有Condition都成立的时候，@Conditional的结果才成立。</strong></p><p>下面我们来看一下Condition接口。</p><h3 id="_2-condition接口" tabindex="-1"><a class="header-anchor" href="#_2-condition接口" aria-hidden="true">#</a> 2.Condition接口</h3><p>用来表示条件判断的接口，源码如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 判断条件是否匹配
     * context:条件判断上下文
     */</span>
    <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>是一个函数式接口，内部只有一个matches方法，用来判断条件是否成立的，2个参数：</p><ul><li>context：条件上下文，ConditionContext接口类型的，可以用来获取容器中的个人信息</li><li>metadata：用来获取被@Conditional标注的对象上的所有注解信息</li></ul><h3 id="_3-conditioncontext接口" tabindex="-1"><a class="header-anchor" href="#_3-conditioncontext接口" aria-hidden="true">#</a> 3.ConditionContext接口</h3><p>这个接口中提供了一些常用的方法，<strong>可以用来获取spring容器中的各种信息</strong>，看一下源码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ConditionContext</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 返回bean定义注册器，可以通过注册器获取bean定义的各种配置信息
     */</span>
    <span class="token class-name">BeanDefinitionRegistry</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 返回ConfigurableListableBeanFactory类型的bean工厂，相当于一个ioc容器对象
     */</span>
    <span class="token annotation punctuation">@Nullable</span>
    <span class="token class-name">ConfigurableListableBeanFactory</span> <span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 返回当前spring容器的环境配置信息对象
     */</span>
    <span class="token class-name">Environment</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 返回资源加载器
     */</span>
    <span class="token class-name">ResourceLoader</span> <span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 返回类加载器
     */</span>
    <span class="token annotation punctuation">@Nullable</span>
    <span class="token class-name">ClassLoader</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-条件判断什么时候执行" tabindex="-1"><a class="header-anchor" href="#_4-条件判断什么时候执行" aria-hidden="true">#</a> 4.条件判断什么时候执行</h3><p>Spring对配置类的处理主要分为2个阶段：</p><p><strong>配置类解析阶段</strong></p><p>会得到一批配置类的信息，和一些需要注册的bean</p><p><strong>bean注册阶段</strong></p><p>将配置类解析阶段得到的配置类和需要注册的bean注册到spring容器中</p><p><strong>看一下什么是配置类</strong></p><p>类中有下面任意注解之一的就属于配置类：</p><ol><li>类上有@Compontent注解</li><li>类上有@Configuration注解</li><li>类上有@CompontentScan注解</li><li>类上有@Import注解</li><li>类上有@ImportResource注解</li><li>类中有@Bean标注的方法</li></ol><blockquote><p>判断一个类是不是一个配置类，是否的是下面这个方法，有兴趣的可以看一下：</p><p>org.springframework.context.annotation.ConfigurationClassUtils#isConfigurationCandidate</p></blockquote><p>spring中处理这2个过程会循环进行，直到完成所有配置类的解析及所有bean的注册。</p><p><strong>Spring对配置类处理过程</strong></p><p>源码位置：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>org.springframework.context.annotation.ConfigurationClassPostProcessor#processConfigBeanDefinitions
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>整个过程大致的过程如下：</p><ol><li>通常我们会通过<code>new AnnotationConfigApplicationContext()</code>传入多个配置类来启动spring容器</li><li>spring对传入的多个配置类进行解析</li><li>配置类解析阶段：这个过程就是处理配置类上面6中注解的过程，此过程中又会发现很多新的配置类，比如<code>@Import</code>导入的一批新的类刚好也符合配置类，而被<code>@CompontentScan</code>扫描到的一些类刚好也是配置类；此时会对这些新产生的配置类进行同样的过程解析</li><li>bean注册阶段：配置类解析后，会得到一批配置类和一批需要注册的bean，此时spring容器会将这批配置类作为bean注册到spring容器，同样也会将这批需要注册的bean注册到spring容器</li><li>经过上面第3个阶段之后，spring容器中会注册很多新的bean，这些新的bean中可能又有很多新的配置类</li><li>Spring从容器中将所有bean拿出来，遍历一下，会过滤得到一批未处理的新的配置类，继续交给第3步进行处理</li><li>step3到step6，这个过程会经历很多次，直到完成所有配置类的解析和bean的注册</li></ol><p>从上面过程中可以了解到：</p><ol><li><strong>可以在配置类上面加上@Conditional注解，来控制是否需要解析这个配置类</strong>，配置类如果不被解析，那么这个配置上面6种注解的解析都会被跳过</li><li><strong>可以在被注册的bean上面加上@Conditional注解，来控制这个bean是否需要注册到spring容器中</strong></li><li><strong>如果配置类不会被注册到容器，那么这个配置类解析所产生的所有新的配置类及所产生的所有新的bean都不会被注册到容器</strong></li></ol><p>一个配置类被spring处理有2个阶段：<strong>配置类解析阶段、bean注册阶段</strong>（将配置类作为bean被注册到spring容器)。</p><p>如果将Condition接口的实现类作为配置类上@Conditional中，那么这个条件会对两个阶段都有效，此时通过Condition是无法精细的控制某个阶段的，如果想控制某个阶段，<strong>比如可以让他解析，但是不能让他注册</strong>，此时就就需要用到另外一个接口了：<code>ConfigurationCondition</code></p><h3 id="_5-configurationcondition接口" tabindex="-1"><a class="header-anchor" href="#_5-configurationcondition接口" aria-hidden="true">#</a> 5.ConfigurationCondition接口</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ConfigurationCondition</span> <span class="token keyword">extends</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 条件判断的阶段，是在解析配置类的时候过滤还是在创建bean的时候过滤
     */</span>
    <span class="token class-name">ConfigurationPhase</span> <span class="token function">getConfigurationPhase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 表示阶段的枚举：2个值
     */</span>
    <span class="token keyword">enum</span> <span class="token class-name">ConfigurationPhase</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * 配置类解析阶段，如果条件为false，配置类将不会被解析
         */</span>
        <span class="token constant">PARSE_CONFIGURATION</span><span class="token punctuation">,</span>
        <span class="token doc-comment comment">/**
         * bean注册阶段，如果为false，bean将不会被注册
         */</span>
        <span class="token constant">REGISTER_BEAN</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ConfigurationCondition接口相对于Condition接口多了一个getConfigurationPhase方法，用来指定条件判断的阶段，是在解析配置类的时候过滤还是在创建bean的时候过滤。</p><h3 id="_6-案例一-阻止配置类的处理" tabindex="-1"><a class="header-anchor" href="#_6-案例一-阻止配置类的处理" aria-hidden="true">#</a> 6.案例一：阻止配置类的处理</h3><blockquote><ol><li>自定义一个类，实现Condition或ConfigurationCondition接口，实现matches方法</li><li>在目标对象上使用@Conditional注解，并指定value的指为自定义的Condition类型</li><li>启动spring容器加载资源，此时@Conditional就会起作用了</li></ol></blockquote><p>在配置类上面使用@Conditional，这个注解的value指定的Condition当有一个为false的时候，spring就会跳过处理这个配置类。</p><p>自定义一个Condition类：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test3</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Condition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConditionContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">AnnotatedTypeMetadata</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCondition1</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>matches方法内部我们可以随意发挥，此处为了演示效果就直接返回false。</p><p>来个配置类，在配置类上面使用上面这个条件，此时会让配置类失效，如下</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test3</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Conditional</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">MyCondition1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//@1</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig3</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//@1</span>
        <span class="token keyword">return</span> <span class="token string">&quot;路人甲Java&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>使用了自定义的条件类</p><p>@2：通过@Bean标注这name这个方法，如果这个配置类成功解析，会将name方法的返回值作为bean注册到spring容器</p></blockquote><p>来个测试类，启动spring容器加载MainConfig3配置类，如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test3<span class="token punctuation">.</span></span><span class="token class-name">MainConfig3</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AnnotationConfigApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConditionTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig3</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> serviceMap <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serviceMap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s-&gt;%s&quot;</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>test3中，从容器中获取String类型的bean，运行test3没有任何输出。</p><p>我们可以将MainConfig3上面的@Conditional去掉，再次运行输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>name-&gt;路人甲Java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_7-案例2-阻止bean的注册" tabindex="-1"><a class="header-anchor" href="#_7-案例2-阻止bean的注册" aria-hidden="true">#</a> 7.案例2：阻止bean的注册</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test4</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test3<span class="token punctuation">.</span></span><span class="token class-name">MyCondition1</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Conditional</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig4</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">MyCondition1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//@1</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;路人甲Java&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;上海市&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面2个方法上面使用了@Bean注解来定义了2个bean，name方法上面使用了@Conditional注解，这个条件会在name这个bean注册到容器之前会进行判断，当条件为true的时候，name这个bean才会被注册到容器。</p><p>ConditionTest中新增个测试用例来加载上面这个配置类，从容器中获取String类型所有bean输出，代码如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig4</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> serviceMap <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    serviceMap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s-&gt;%s&quot;</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>address-&gt;上海市
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以看到容器中只有一个address被注册了，而name这个bean没有被注册。</p><h3 id="_8-案例3-bean不存在的时候才注册" tabindex="-1"><a class="header-anchor" href="#_8-案例3-bean不存在的时候才注册" aria-hidden="true">#</a> 8.案例3：bean不存在的时候才注册</h3><p><strong>需求</strong></p><p>IService接口有两个实现类Service1和Service1，这两个类会放在2个配置类中通过@Bean的方式来注册到容器，此时我们想加个限制，只允许有一个IService类型的bean被注册到容器。</p><p>可以在@Bean标注的2个方法上面加上条件限制，当容器中不存在IService类型的bean时，才将这个方法定义的bean注册到容器，下面来看代码实现。</p><p><strong>条件判断类：OnMissingBeanCondition</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">ConfigurableListableBeanFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Condition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConditionContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationCondition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">AnnotatedTypeMetadata</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnMissingBeanCondition</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取bean工厂</span>
        <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//从容器中获取IService类型bean</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">IService</span><span class="token punctuation">&gt;</span></span> serviceMap <span class="token operator">=</span> beanFactory<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">IService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断serviceMap是否为空</span>
        <span class="token keyword">return</span> serviceMap<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>IService接口</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test1</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Service1</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test1</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service1</span> <span class="token keyword">implements</span> <span class="token class-name">IService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Service2</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test1</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service2</span> <span class="token keyword">implements</span> <span class="token class-name">IService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Conditional</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig1</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">OnMissingBeanCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//@1</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">IService</span> <span class="token function">service1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Service1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Conditional</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig2</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">OnMissingBeanCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token comment">//@1</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">IService</span> <span class="token function">service2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Service2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test1</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Import</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">BeanConfig1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">BeanConfig2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//@1</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig1</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">IService</span><span class="token punctuation">&gt;</span></span> serviceMap <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">IService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    serviceMap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s-&gt;%s&quot;</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>service1-&gt;com.javacode2018.lesson001.demo25.test1.Service1@2cd76f31
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以看出容器中只有一个IService类型的bean。</p><p>可以将@Bean标注的2个方法上面的@Conditional去掉，再运行会输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>service1-&gt;com.javacode2018.lesson001.demo25.test1.Service1@49438269
service2-&gt;com.javacode2018.lesson001.demo25.test1.Service2@ba2f4ec
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>此时没有条件限制，2个Service都会注册到容器。</p><h3 id="_9-案例4-根据环境选择配置类" tabindex="-1"><a class="header-anchor" href="#_9-案例4-根据环境选择配置类" aria-hidden="true">#</a> 9.案例4：根据环境选择配置类</h3><p>平常我们做项目的时候，有开发环境、测试环境、线上环境，每个环境中有些信息是不一样的，比如数据库的配置信息，下面我们来模拟不同环境中使用不同的配置类来注册不同的bean。</p><p><strong>自定义一个条件的注解</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Conditional</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">EnvCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//@1</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnvConditional</span> <span class="token punctuation">{</span>
    <span class="token comment">//环境(测试环境、开发环境、生产环境)</span>
    <span class="token keyword">enum</span> <span class="token class-name">Env</span> <span class="token punctuation">{</span> <span class="token comment">//@2</span>
        <span class="token constant">TEST</span><span class="token punctuation">,</span> <span class="token constant">DEV</span><span class="token punctuation">,</span> <span class="token constant">PROD</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//环境</span>
    <span class="token class-name">Env</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">Env</span><span class="token punctuation">.</span><span class="token constant">DEV</span><span class="token punctuation">;</span> <span class="token comment">//@3默认开发环境</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@1：注意这个注解比较特别，这个注解上面使用到了@Conditional注解，这个地方使用到了一个自定义Conditione类：EnvCondition</p><p>@2：枚举，表示环境，定义了3个环境</p><p>@3：这个参数用指定环境</p><p>上面这个注解一会我们会用在不同环境的配置类上面</p><p><strong>下面来3个配置类</strong></p><p>让3个配置类分别在不同环境中生效，会在这些配置类上面使用上面自定义的@EnvConditional注解来做条件限定。</p><p>每个配置类中通过@Bean来定义一个名称为name的bean，一会通过输出这个bean来判断哪个配置类生效了。</p><p>下面来看3个配置类的代码</p><p><strong>测试环境配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnvConditional</span><span class="token punctuation">(</span><span class="token class-name">EnvConditional<span class="token punctuation">.</span>Env</span><span class="token punctuation">.</span><span class="token constant">TEST</span><span class="token punctuation">)</span><span class="token comment">//@1</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBeanConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;我是测试环境!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>开发环境配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnvConditional</span><span class="token punctuation">(</span><span class="token class-name">EnvConditional<span class="token punctuation">.</span>Env</span><span class="token punctuation">.</span><span class="token constant">DEV</span><span class="token punctuation">)</span> <span class="token comment">//@1</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DevBeanConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;我是开发环境!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>生产环境配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnvConditional</span><span class="token punctuation">(</span><span class="token class-name">EnvConditional<span class="token punctuation">.</span>Env</span><span class="token punctuation">.</span><span class="token constant">PROD</span><span class="token punctuation">)</span> <span class="token comment">//@1</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProdBeanConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;我是生产环境!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>条件类：EnvCondition</strong></p><p>条件类会解析配置类上面@EnvConditional注解，得到环境信息。</p><p>然后和目前的环境对比，决定返回true还是false，如下：</p><blockquote><p>@1：这个用来指定当前使用的环境，此处假定当前使用的是开发环境，这个我们以后可以任意发挥，比如将这些放到配置文件中，此处方便演示效果。</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test2</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Condition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConditionContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">AnnotatedTypeMetadata</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EnvCondition</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//当前需要使用的环境</span>
        <span class="token class-name">EnvConditional<span class="token punctuation">.</span>Env</span> curEnv <span class="token operator">=</span> <span class="token class-name">EnvConditional<span class="token punctuation">.</span>Env</span><span class="token punctuation">.</span><span class="token constant">DEV</span><span class="token punctuation">;</span> <span class="token comment">//@1</span>
        <span class="token comment">//获取使用条件的类上的EnvCondition注解中对应的环境</span>
        <span class="token class-name">EnvConditional<span class="token punctuation">.</span>Env</span> env <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EnvConditional<span class="token punctuation">.</span>Env</span><span class="token punctuation">)</span> metadata<span class="token punctuation">.</span><span class="token function">getAllAnnotationAttributes</span><span class="token punctuation">(</span><span class="token class-name">EnvConditional</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>curEnv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>运行输出</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>我是开发环境!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以看到开发环境生效了。</p><p>修改一下EnvCondition的代码，切换到生产环境：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">EnvConditional<span class="token punctuation">.</span>Env</span> curEnv <span class="token operator">=</span> <span class="token class-name">EnvConditional<span class="token punctuation">.</span>Env</span><span class="token punctuation">.</span><span class="token constant">PROD</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>再次运行test2方法输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>我是生产环境!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>生产环境配置类生效了。</p><h3 id="_10-案例5-condition指定优先级" tabindex="-1"><a class="header-anchor" href="#_10-案例5-condition指定优先级" aria-hidden="true">#</a> 10.案例5：Condition指定优先级</h3><p><strong>多个Condition按顺序执行</strong></p><p>@Condtional中value指定多个Condtion的时候，默认情况下会按顺序执行，还是通过代码来看一下效果。</p><p>下面代码中定义了3个Condition，每个Condition的matches方法中会输出当前类名，然后在配置类上面同时使用这3个Condition：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test5</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Condition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConditionContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Conditional</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">AnnotatedTypeMetadata</span></span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Condition1</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Condition2</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Condition3</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Condition1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Condition2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Condition3</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig5</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig5</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>输出</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test5<span class="token punctuation">.</span></span>Condition1</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test5<span class="token punctuation">.</span></span>Condition2</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test5<span class="token punctuation">.</span></span>Condition3</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test5<span class="token punctuation">.</span></span>Condition1</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test5<span class="token punctuation">.</span></span>Condition2</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test5<span class="token punctuation">.</span></span>Condition3</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test5<span class="token punctuation">.</span></span>Condition1</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test5<span class="token punctuation">.</span></span>Condition2</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test5<span class="token punctuation">.</span></span>Condition3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面有多行输出，是因为spring解析整个配置类的过程中，有好几个地方都会执行条件判断。</p><p>咱们只用关注前3行，可以看出输出的属性和@Conditional中value值的顺序是一样的。</p><p><strong>指定Condition的顺序</strong></p><p>自定义的Condition可以实现PriorityOrdered接口或者继承Ordered接口，或者使用@Order注解，通过这些来指定这些Condition的优先级。</p><p><strong>排序规则：先按PriorityOrdered排序，然后按照order的值进行排序；也就是：PriorityOrdered asc,order值 asc</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>下面这几个都可以指定order的值
接口：<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>Ordered</span>，有个getOrder方法用来返回<span class="token keyword">int</span>类型的值
接口：<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>PriorityOrdered</span>，继承了<span class="token class-name">Ordered</span>接口，所以也有getOrder方法
注解：<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>Order</span>，有个<span class="token keyword">int</span>类型的value参数指定<span class="token class-name">Order</span>的大小
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test6</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Condition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConditionContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Conditional</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">PriorityOrdered</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">AnnotatedTypeMetadata</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//@1</span>
<span class="token keyword">class</span> <span class="token class-name">Condition1</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Condition2</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span> <span class="token comment">//@2</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//@3</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Condition3</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span><span class="token punctuation">,</span> <span class="token class-name">PriorityOrdered</span> <span class="token punctuation">{</span> <span class="token comment">//@4</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Condition1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Condition2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Condition3</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//@5</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig6</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>@1：Condition1通过@Order指定顺序，值为1</p><p>@2：Condition2通过实现了Ordered接口来指定顺序，@3：getOrder方法返回1</p><p>@4：Condition3实现了PriorityOrdered接口，实现这个接口需要重写getOrder方法，返回1000</p><p>@5：Condtion顺序为1、2、3</p></blockquote><p>根据排序的规则，PriorityOrdered的会排在前面，然后会再按照order升序，最后可以顺序是：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Condtion3-&gt;Condtion2-&gt;Condtion1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>来个测试用例看看效果是不是我们分析的这样：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig6</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行test6，部分输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>com.javacode2018.lesson001.demo25.test6.Condition3
com.javacode2018.lesson001.demo25.test6.Condition2
com.javacode2018.lesson001.demo25.test6.Condition1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果和我们分析的一致。</p><h3 id="_11-案例6-configurationcondition的使用" tabindex="-1"><a class="header-anchor" href="#_11-案例6-configurationcondition的使用" aria-hidden="true">#</a> 11.案例6：ConfigurationCondition的使用</h3><p>ConfigurationCondition使用的比较少，很多地方对这个基本上也不会去介绍，Condition接口基本上可以满足99%的需求了，但是springboot中却大量用到了ConfigurationCondition这个接口。</p><p>ConfigurationCondition通过解释比较难理解，来个案例感受一下：</p><p><strong>来一个普通的类：Service</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test7</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>来一个配置类，通过配置类注册上面这个Service</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test7</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig1</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Service</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>再来一个配置类：BeanConfig2</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test7</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig2</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;路人甲Java&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>来一个总的配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test7</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Import</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">BeanConfig1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">BeanConfig2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig7</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>来个测试用例加载MainConfig7配置类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test7</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig7</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s-&gt;%s&quot;</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面从容器中获取String类型的bean，然后输出。</p><p><strong>运行输出</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>name-&gt;路人甲Java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>现在我们有个需求</strong></p><p>当容器中有Service这种类型的bean的时候，BeanConfig2才生效。</p><p>很简单吧，加个Condition就行了，内部判断容器中是否有Service类型的bean，继续</p><p><strong>来个自定义的Condition</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test7</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">ConfigurableListableBeanFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Condition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConditionContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">AnnotatedTypeMetadata</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCondition1</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取spring容器</span>
        <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断容器中是否存在Service类型的bean</span>
        <span class="token keyword">boolean</span> existsService <span class="token operator">=</span> <span class="token operator">!</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">Service</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> existsService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>BeanConfig2上使用Condition条件判断</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">MyCondition1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig2</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;路人甲Java&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>再次运行test7输出</strong></p><p>无任何输出</p><p><strong>为什么？</strong></p><p>在文章前面我们说过，配置类的处理会依次经过2个阶段：配置类解析阶段和bean注册阶段，Condition接口类型的条件会对这两个阶段都有效，解析阶段的时候，容器中是还没有Service这个bean的，配置类中通过@Bean注解定义的bean在bean注册阶段才会被注册到spring容器，所以BeanConfig2在解析阶段去容器中是看不到Service这个bean的，所以就被拒绝了。</p><p><strong>此时我们需要用到ConfigurationCondition了，让条件判断在bean注册阶段才起效。</strong></p><p><strong>自定义一个ConfigurationCondition类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacode2018<span class="token punctuation">.</span>lesson001<span class="token punctuation">.</span>demo25<span class="token punctuation">.</span>test7</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">ConfigurableListableBeanFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConditionContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationCondition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">AnnotatedTypeMetadata</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfigurationCondition1</span> <span class="token keyword">implements</span> <span class="token class-name">ConfigurationCondition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ConfigurationPhase</span> <span class="token function">getConfigurationPhase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ConfigurationPhase</span><span class="token punctuation">.</span><span class="token constant">REGISTER_BEAN</span><span class="token punctuation">;</span> <span class="token comment">//@1</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取spring容器</span>
        <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断容器中是否存在Service类型的bean</span>
        <span class="token keyword">boolean</span> existsService <span class="token operator">=</span> <span class="token operator">!</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">Service</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> existsService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>@1：指定条件在bean注册阶段，这个条件才有效</p><p>matches方法中的内容直接复制过来，判断规则不变。</p></blockquote><p><strong>修改BeanConfig2的类容</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>将
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">MyCondition1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
替换为
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">MyConfigurationCondition1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>再次运行test7输出</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>name-&gt;路人甲Java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>此时name这个bean被输出了。</p><p>可以再试试将BeanConfig1中service方法上面的@Bean去掉，此时Service就不会被注册到容器，再运行一下test7，会发现没有输出了，此时BeanConfig2会失效。</p><p><strong>判断bean存不存在的问题，通常会使用ConfigurationCondition这个接口，阶段为：REGISTER_BEAN，这样可以确保条件判断是在bean注册阶段执行的。</strong></p><p>对springboot比较熟悉的，它里面有很多@Conditionxxx这样的注解，可以去看一下这些注解，很多都实现了ConfigurationCondition接口。</p><h3 id="_12-总结" tabindex="-1"><a class="header-anchor" href="#_12-总结" aria-hidden="true">#</a> 12.总结</h3><ol><li>@Conditional注解可以标注在spring需要处理的对象上（配置类、@Bean方法），相当于加了个条件判断，通过判断的结果，让spring觉得是否要继续处理被这个注解标注的对象</li><li>spring处理配置类大致有2个过程：解析配置类、注册bean，这两个过程中都可以使用@Conditional来进行控制spring是否需要处理这个过程</li><li>Condition默认会对2个过程都有效</li><li>ConfigurationCondition控制得更细一些，可以控制到具体那个阶段使用条件判断</li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/pages/Spring/Spring/3-IOC相关注解.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 842830066@qq.com">huluhutu</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/huluhutublog/pages/Spring/Spring/2-Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" class="nav-link prev" aria-label="Bean的生命周期"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->Bean的生命周期</div></a><a href="/huluhutublog/pages/Spring/Spring/4-DI%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3.html" class="nav-link next" aria-label="DI相关注解"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">DI相关注解<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2022 huluhutu</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/huluhutublog/assets/app.0662e65c.js" defer></script>
  </body>
</html>
